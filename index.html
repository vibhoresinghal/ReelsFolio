<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ReelsFolio</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body,
        html {
            height: 100%;
            overflow: hidden;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        }

        /* Background layer that transitions colors */
        .bg-layer {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            transition: background-color 0.6s ease-in-out;
            z-index: -1;
        }

        /* The scroll container */
        .video-container {
            height: 100vh;
            overflow-y: scroll;
            scroll-snap-type: y mandatory;
            scrollbar-width: none;
            -ms-overflow-style: none;
        }

        .video-container::-webkit-scrollbar {
            display: none;
        }

        /* Individual video sections */
        .video-section {
            height: 100vh;
            width: 100vw;
            scroll-snap-align: center;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
        }

        /* Video frame container - 9:16 aspect ratio (phone-like) */
        .video-frame {
            position: relative;
            /* 
             * Width calculation that maintains 9:16 ratio within viewport:
             * - min 280px on very small screens
             * - max 380px on large screens  
             * - 50vw for horizontal responsiveness
             * - calc(80vh * 9 / 16) ensures height won't exceed 80% of viewport
             */
            width: min(clamp(280px, 50vw, 380px), calc(80vh * 9 / 16));
            aspect-ratio: 9/16;
            /* Responsive border radius */
            border-radius: clamp(16px, 3vw, 24px);
            overflow: hidden;
            /* Responsive shadow */
            box-shadow: 0 clamp(15px, 3vh, 25px) clamp(40px, 8vh, 80px) rgba(0, 0, 0, 0.4);
            opacity: 0.2;
            transform: scale(0.9);
            transition: opacity 0.5s ease-in-out, transform 0.5s ease-in-out;
        }

        .video-section.active .video-frame {
            opacity: 1;
            transform: scale(1);
        }

        /* R2/HTML5 video - scale to fill vertical 9:16 frame */
        .video-frame video {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            min-width: 100%;
            min-height: 100%;
            width: auto;
            height: 100%;
            object-fit: cover;
            cursor: pointer;
        }

        /* R2 video play button overlay - matches control bar style */
        .video-frame .play-overlay-btn {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 60px;
            height: 60px;
            background: rgba(255, 255, 255, 0.2);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            z-index: 100;
            opacity: 0;
            pointer-events: none;
            transition: all 0.3s ease;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
        }

        /* Only show button when paused */
        .video-frame .play-overlay-btn.paused {
            opacity: 1;
            pointer-events: auto;
        }

        .video-frame .play-overlay-btn:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: translate(-50%, -50%) scale(1.05);
        }

        .play-overlay-btn svg {
            width: 28px;
            height: 28px;
            margin-left: 3px;
        }

        .play-overlay-btn svg polygon {
            fill: white;
        }

        /* Decorative stickers */
        .sticker {
            position: absolute;
            opacity: 0;
            transform: scale(0.5);
            transition: opacity 0.5s ease-in-out 0.1s, transform 0.5s ease-in-out 0.1s;
            pointer-events: none;
        }

        .video-section.active .sticker {
            opacity: 1;
            transform: scale(1);
        }

        /* Heart sticker - responsive positioning */
        .sticker-heart {
            top: 15%;
            right: calc(50% - min(280px, 25vw));
            font-size: clamp(32px, 5vw, 48px);
        }

        /* Star sticker - responsive positioning */
        .sticker-star {
            top: 20%;
            left: calc(50% - min(300px, 27vw));
            width: clamp(50px, 7vw, 80px);
            height: clamp(50px, 7vw, 80px);
        }

        /* Plus sticker - responsive positioning */
        .sticker-plus {
            bottom: 35%;
            left: calc(50% - min(250px, 22vw));
            font-size: clamp(28px, 4vw, 40px);
            color: #f0a0d0;
        }

        /* Sparkle sticker - responsive positioning */
        .sticker-sparkle {
            bottom: 40%;
            right: calc(50% - min(280px, 25vw));
            font-size: clamp(22px, 3.5vw, 32px);
        }

        /* Squiggle sticker - responsive positioning */
        .sticker-squiggle {
            bottom: 15%;
            left: calc(50% - min(280px, 25vw));
            width: clamp(40px, 5vw, 60px);
        }

        /* Info bars on the sides - responsive positioning */
        .info-bar {
            position: absolute;
            display: flex;
            flex-direction: column;
            gap: clamp(8px, 1.5vw, 12px);
            opacity: 0;
            transform: translateX(-20px);
            transition: opacity 0.5s ease-in-out 0.15s, transform 0.5s ease-in-out 0.15s;
        }

        .info-bar.right {
            right: calc(50% - min(420px, 35vw));
            top: 50%;
            transform: translateY(-50%) translateX(20px);
        }

        .video-section.active .info-bar {
            opacity: 1;
            transform: translateX(0);
        }

        .video-section.active .info-bar.right {
            transform: translateY(-50%) translateX(0);
        }

        .info-bar.left {
            left: calc(50% - min(420px, 35vw));
            top: 40%;
        }

        .info-line {
            height: clamp(8px, 1.2vw, 12px);
            background: rgba(255, 255, 255, 0.25);
            border-radius: clamp(4px, 0.6vw, 6px);
        }

        .info-line.short {
            width: clamp(40px, 6vw, 60px);
        }

        .info-line.medium {
            width: clamp(65px, 9vw, 100px);
        }

        .info-line.long {
            width: clamp(90px, 12vw, 140px);
        }

        .info-dot {
            width: clamp(20px, 2.5vw, 28px);
            height: clamp(20px, 2.5vw, 28px);
            background: rgba(255, 255, 255, 0.3);
            border-radius: 50%;
        }

        .info-group {
            display: flex;
            align-items: center;
            gap: clamp(8px, 1.2vw, 12px);
        }

        /* Toggle button design */
        .toggle-btn {
            display: flex;
            align-items: center;
            background: rgba(255, 255, 255, 0.15);
            padding: clamp(6px, 1vw, 8px) clamp(12px, 1.5vw, 16px);
            border-radius: clamp(18px, 2.5vw, 25px);
            gap: clamp(8px, 1.2vw, 12px);
        }

        .toggle-btn .line {
            width: clamp(35px, 5vw, 50px);
            height: clamp(6px, 0.8vw, 8px);
            background: rgba(255, 255, 255, 0.4);
            border-radius: clamp(3px, 0.4vw, 4px);
        }

        .toggle-btn .circle {
            width: clamp(18px, 2.2vw, 24px);
            height: clamp(18px, 2.2vw, 24px);
            background: rgba(255, 255, 255, 0.5);
            border-radius: 50%;
        }

        /* Control bar container - responsive positioning */
        .control-bar {
            position: fixed;
            bottom: clamp(12px, 3vh, 20px);
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            align-items: center;
            gap: clamp(8px, 2vw, 12px);
            z-index: 1000;
            transition: opacity 0.3s ease, visibility 0.3s ease;
            opacity: 1;
            visibility: visible;
        }

        .control-bar.hidden {
            opacity: 0;
            visibility: hidden;
        }

        /* Unmute button - responsive sizing */
        .unmute-btn {
            background: rgba(255, 255, 255, 0.2);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.3);
            color: white;
            padding: clamp(10px, 2vh, 14px) clamp(18px, 4vw, 28px);
            border-radius: 50px;
            font-size: clamp(12px, 2vw, 15px);
            font-family: inherit;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: clamp(6px, 1.5vw, 10px);
            transition: all 0.3s ease;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.2);
        }

        .unmute-btn:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: scale(1.05);
        }

        .unmute-btn svg {
            width: clamp(16px, 3vw, 20px);
            height: clamp(16px, 3vw, 20px);
        }

        /* Play/Stop button - responsive circular button */
        .play-stop-btn {
            width: clamp(40px, 8vw, 50px);
            height: clamp(40px, 8vw, 50px);
            background: rgba(255, 255, 255, 0.2);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            color: white;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.2);
        }

        .play-stop-btn:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: scale(1.1);
        }

        .play-stop-btn svg {
            width: clamp(28px, 6vw, 40px);
            height: clamp(28px, 6vw, 40px);
        }

        /* Grid button at top - responsive sizing */
        .grid-btn {
            position: fixed;
            top: clamp(12px, 3vh, 20px);
            left: 50%;
            transform: translateX(-50%);
            width: clamp(40px, 8vw, 50px);
            height: clamp(40px, 8vw, 50px);
            background: rgba(255, 255, 255, 0.2);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            color: white;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            transition: all 0.3s ease, opacity 0.3s ease, visibility 0.3s ease;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.2);
            opacity: 1;
            visibility: visible;
        }

        .grid-btn.hidden {
            opacity: 0;
            visibility: hidden;
        }

        .grid-btn:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: translateX(-50%) scale(1.1);
        }

        .grid-btn svg {
            width: clamp(18px, 4vw, 24px);
            height: clamp(18px, 4vw, 24px);
        }

        /* Grid Section - scrollable section before videos */
        .grid-section {
            height: 100vh;
            width: 100vw;
            scroll-snap-align: center;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
            background: #1a1a2e;
        }

        .grid-container {
            display: grid;
            /* Fixed 5 columns - Tab 1 gets 5x2, Tabs 2-4 get 4 items in 1 row */
            grid-template-columns: repeat(5, auto);
            justify-content: center;
            align-content: center;
            justify-items: center;
            align-items: center;
            /* Consistent spacing across all tabs */
            gap: clamp(10px, 2vw, 16px);
            padding: clamp(8px, 2vw, 16px);
            max-width: 95vw;
            width: 100%;
            /* No internal scroll - fit everything in viewport */
            opacity: 0.2;
            transform: scale(0.9);
            transition: opacity 0.5s ease-in-out, transform 0.5s ease-in-out;
        }

        .grid-section.active .grid-container {
            opacity: 1;
            transform: scale(1);
        }

        .grid-item {
            /* Same 9:16 aspect ratio as the video frame */
            aspect-ratio: 9/16;
            /* Calculate max height to fit 2 rows with gap and title space */
            max-height: calc((100vh - 180px) / 2);
            width: auto;
            border-radius: clamp(8px, 1.5vw, 12px);
            overflow: hidden;
            cursor: pointer;
            background: rgba(255, 255, 255, 0.1);
            border: 2px solid transparent;
            transition: all 0.3s ease;
            position: relative;
        }

        .grid-item:hover {
            transform: scale(1.03);
            border-color: rgba(255, 255, 255, 0.5);
        }

        .grid-item img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .grid-item .video-number {
            position: absolute;
            bottom: clamp(4px, 1vh, 8px);
            left: clamp(4px, 1vw, 8px);
            background: rgba(0, 0, 0, 0.7);
            color: white;
            padding: clamp(2px, 0.5vh, 4px) clamp(6px, 1vw, 10px);
            border-radius: clamp(10px, 2vw, 16px);
            font-size: clamp(10px, 1.5vw, 12px);
            font-weight: 500;
        }

        /* Tab Navigation */
        .tab-nav {
            position: fixed;
            top: clamp(12px, 3vh, 20px);
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            gap: clamp(4px, 1vw, 8px);
            z-index: 1001;
            background: rgba(0, 0, 0, 0.3);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            padding: clamp(4px, 0.8vw, 6px);
            border-radius: 50px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .tab-btn {
            padding: clamp(8px, 1.5vh, 12px) clamp(16px, 3vw, 24px);
            background: transparent;
            border: none;
            color: rgba(255, 255, 255, 0.6);
            font-size: clamp(12px, 2vw, 14px);
            font-weight: 500;
            font-family: inherit;
            cursor: pointer;
            border-radius: 50px;
            transition: all 0.3s ease;
            white-space: nowrap;
        }

        .tab-btn:hover {
            color: rgba(255, 255, 255, 0.9);
            background: rgba(255, 255, 255, 0.1);
        }

        .tab-btn.active {
            background: rgba(255, 255, 255, 0.2);
            color: white;
        }

        /* Tab Content */
        .tabs-container {
            display: flex;
            width: 400vw;
            /* Will be updated dynamically */
            height: 100vh;
            transition: transform 0.5s ease-in-out;
        }

        .tab-content {
            flex: 0 0 100vw;
            width: 100vw;
            height: 100vh;
            overflow: hidden;
        }

        /* Hide grid button when tabs are visible */
        .grid-btn {
            display: none;
        }

        @media (max-width: 900px) {

            .info-bar,
            .sticker {
                display: none;
            }
        }

        @media (max-height: 600px) {
            .grid-container {
                max-height: 80vh;
                overflow-y: auto;
            }
        }
    </style>
</head>

<body>
    <!-- Background that transitions with each video -->
    <div class="bg-layer" id="bgLayer"></div>

    <!-- Tab Navigation -->
    <nav class="tab-nav" id="tabNav"></nav>

    <!-- Horizontal Tabs Container -->
    <div class="tabs-container" id="tabsContainer"></div>

    <!-- Grid Button at Top (hidden, replaced by tabs) -->
    <button class="grid-btn hidden" id="gridBtn" onclick="goToVideo(0)">
        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                d="M4 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2V6zM14 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2V6zM4 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2v-2zM14 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2v-2z" />
        </svg>
    </button>

    <!-- Control Bar -->
    <div class="control-bar">
        <!-- Play/Stop Button -->
        <button class="play-stop-btn" id="playStopBtn" onclick="togglePlayStop()">
            <svg id="pauseIcon" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"
                stroke="currentColor">
                <rect x="6" y="6" width="12" height="12" rx="1" stroke-width="2" />
            </svg>
            <svg id="playIcon" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"
                style="display: none;">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                    d="M14.752 11.168l-3.197-2.132A1 1 0 0010 9.87v4.263a1 1 0 001.555.832l3.197-2.132a1 1 0 000-1.664z" />
            </svg>
        </button>

        <!-- Sound Toggle Button -->
        <button class="unmute-btn" id="soundBtn" onclick="toggleSound()">
            <svg id="mutedIcon" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"
                stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                    d="M5.586 15H4a1 1 0 01-1-1v-4a1 1 0 011-1h1.586l4.707-4.707C10.923 3.663 12 4.109 12 5v14c0 .891-1.077 1.337-1.707.707L5.586 15z" />
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                    d="M17 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2" />
            </svg>
            <svg id="unmutedIcon" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"
                stroke="currentColor" style="display: none;">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                    d="M15.536 8.464a5 5 0 010 7.072m2.828-9.9a9 9 0 010 12.728M5.586 15H4a1 1 0 01-1-1v-4a1 1 0 011-1h1.586l4.707-4.707C10.923 3.663 12 4.109 12 5v14c0 .891-1.077 1.337-1.707.707L5.586 15z" />
            </svg>
            <span id="soundBtnText">Unmute</span>
        </button>
    </div>

    <script>
        // State
        let videosData = null;
        let currentTab = 0;
        let isMuted = true;
        let isPlaying = true;
        let observer = null;
        let currentVideoId = null;
        let videosReady = {};
        let firstInteraction = {};

        // DOM Elements
        const bgLayer = document.getElementById('bgLayer');
        const tabNav = document.getElementById('tabNav');
        const tabsContainer = document.getElementById('tabsContainer');
        const gridBtn = document.getElementById('gridBtn');
        const controlBar = document.querySelector('.control-bar');

        // Fetch JSON and initialize
        async function initApp() {
            try {
                const response = await fetch('videos.json');
                videosData = await response.json();
                renderApp();
            } catch (error) {
                console.error('Failed to load videos:', error);
            }
        }

        // Render the entire app structure
        function renderApp() {
            if (!videosData || !videosData.tabs) return;

            // 1. Render Tabs Navigation
            tabNav.innerHTML = videosData.tabs.map((tab, index) =>
                `<button class="tab-btn ${index === 0 ? 'active' : ''}" onclick="switchTab(${index})">${tab.label}</button>`
            ).join('');

            // 2. Render Tabs Content
            tabsContainer.style.width = `${videosData.tabs.length * 100}vw`;
            tabsContainer.innerHTML = videosData.tabs.map((tab, tabIndex) => `
                <div class="tab-content" id="tab-${tab.id}">
                    <div class="video-container">
                        <!-- Grid Section -->
                        <div class="grid-section ${tabIndex === 0 ? 'active' : ''}" data-bg-color="${tab.videos[0].bgColor}">
                            <div class="grid-container">
                                ${tab.videos.map((video, vIndex) => `
                                    <div class="grid-item" onclick="goToVideo(${vIndex + 1}, ${tabIndex})" 
                                         onmouseenter="this.querySelector('video').play()" 
                                         onmouseleave="this.querySelector('video').pause(); this.querySelector('video').currentTime = 0;">
                                        <video src="${video.src}#t=0.1" muted playsinline preload="metadata" style="width: 100%; height: 100%; object-fit: cover;"></video>
                                        <span class="video-number">${vIndex + 1}</span>
                                    </div>
                                `).join('')}
                            </div>
                        </div>

                        <!-- Video Sections -->
                        ${tab.videos.map(video => `
                            <div class="video-section video-section-r2" data-video-id="${video.id}" data-bg-color="${video.bgColor}">
                                <div class="info-bar left">
                                    <div class="info-line long"></div>
                                    <div class="info-line medium"></div>
                                    <div class="info-line short"></div>
                                </div>

                                <div class="sticker sticker-star">
                                    <svg viewBox="0 0 100 100" fill="#FFD700">
                                        <polygon points="50,0 61,35 98,35 68,57 79,91 50,70 21,91 32,57 2,35 39,35" />
                                    </svg>
                                </div>
                                <div class="sticker sticker-heart">ðŸ§¡</div>
                                <div class="sticker sticker-sparkle">âœ¨</div>

                                <div class="video-frame" onclick="toggleVideo('${video.id}')">
                                    <video id="${video.id}" src="${video.src}" muted playsinline preload="metadata" onended="scrollToNextVideo(this)"></video>
                                    <div class="play-overlay-btn" id="btn-${video.id}">
                                         <svg viewBox="0 0 24 24"><polygon points="8,5 19,12 8,19"/></svg>
                                    </div>
                                </div>

                                <div class="info-bar right">
                                    <div class="info-group">
                                        <div class="info-dot"></div>
                                        <div>
                                            <div class="info-line short" style="margin-bottom: 6px;"></div>
                                            <div class="info-line long"></div>
                                        </div>
                                    </div>
                                    <div class="toggle-btn">
                                        <div class="line"></div>
                                        <div class="circle"></div>
                                    </div>
                                </div>
                            </div>
                        `).join('')}
                    </div>
                </div>
            `).join('');

            // Initialize background with first tab's first color
            if (videosData.tabs[0] && videosData.tabs[0].videos[0]) {
                bgLayer.style.backgroundColor = videosData.tabs[0].videos[0].bgColor;
            }

            // Initialize Observer
            initObserver();

            // Setup scroll listeners for navigation
            document.querySelectorAll('.video-container').forEach(container => {
                container.addEventListener('scroll', handleScroll);
            });
        }

        // Intersection Observer logic
        function initObserver() {
            observer = new IntersectionObserver((entries) => {
                entries.forEach(entry => {
                    const parentTab = entry.target.closest('.tab-content');
                    // Find index of parent tab
                    const parentTabIndex = Array.from(tabsContainer.children).indexOf(parentTab);

                    if (parentTabIndex !== currentTab) return;

                    if (entry.isIntersecting) {
                        // Set Active Class
                        entry.target.classList.add('active');

                        // Set Background Color
                        const bgColor = entry.target.getAttribute('data-bg-color');
                        if (bgColor) bgLayer.style.backgroundColor = bgColor;

                        // Identify section type
                        const isGrid = entry.target.classList.contains('grid-section');

                        // Update UI Buttons
                        if (isGrid) {
                            gridBtn.classList.add('hidden');
                            controlBar.classList.add('hidden');
                        } else {
                            gridBtn.classList.remove('hidden');
                            controlBar.classList.remove('hidden');
                        }

                        // Play Video if not grid
                        if (!isGrid) {
                            const videoId = entry.target.getAttribute('data-video-id');
                            playVideo(videoId);
                        }
                    } else {
                        entry.target.classList.remove('active');
                        // Pause Video
                        if (!entry.target.classList.contains('grid-section')) {
                            const videoId = entry.target.getAttribute('data-video-id');
                            pauseVideo(videoId);
                        }
                    }
                });
            }, { threshold: 0.6 });

            document.querySelectorAll('.grid-section, .video-section').forEach(section => {
                observer.observe(section);
            });
        }

        // --- Video Control Functions ---

        function playVideo(videoId) {
            const video = document.getElementById(videoId);
            if (!video) return;

            currentVideoId = videoId;
            isPlaying = true;

            // Update icons
            document.getElementById('pauseIcon').style.display = 'block';
            document.getElementById('playIcon').style.display = 'none';

            video.currentTime = 0;
            video.play().catch(e => console.log('Autoplay blocked:', e));

            video.muted = isMuted;

            // Update overlay button
            const btn = document.getElementById('btn-' + videoId);
            if (btn) btn.classList.remove('paused');
        }

        function pauseVideo(videoId) {
            const video = document.getElementById(videoId);
            if (!video) return;

            video.pause();

            const btn = document.getElementById('btn-' + videoId);
            if (btn) btn.classList.add('paused');
        }

        function scrollToNextVideo(videoEl) {
            const currentSection = videoEl.closest('.video-section');
            const nextSection = currentSection.nextElementSibling;

            if (nextSection && nextSection.classList.contains('video-section')) {
                nextSection.scrollIntoView({ behavior: 'smooth' });
            } else {
                // If it's the last video, maybe loop back to grid? Or just stop.
                // For now, let's stop.
                toggleVideo(videoEl.id); // Show play button again
            }
        }

        function toggleVideo(videoId) {
            const video = document.getElementById(videoId);
            const btn = document.getElementById('btn-' + videoId);
            if (!video) return;

            // First interaction unmute logic
            if (!firstInteraction[videoId]) {
                firstInteraction[videoId] = true;
                video.muted = false;
                isMuted = false;
                updateMuteUI();
            }

            if (video.paused) {
                video.play();
                if (btn) btn.classList.remove('paused');
                isPlaying = true;
                document.getElementById('pauseIcon').style.display = 'block';
                document.getElementById('playIcon').style.display = 'none';
            } else {
                video.pause();
                if (btn) btn.classList.add('paused');
                isPlaying = false;
                document.getElementById('pauseIcon').style.display = 'none';
                document.getElementById('playIcon').style.display = 'block';
            }
        }

        function togglePlayStop() {
            if (!currentVideoId) return;
            toggleVideo(currentVideoId);
        }

        function toggleSound() {
            isMuted = !isMuted;
            updateMuteUI();

            if (currentVideoId) {
                const video = document.getElementById(currentVideoId);
                if (video) video.muted = isMuted;
            }
        }

        function updateMuteUI() {
            const mutedIcon = document.getElementById('mutedIcon');
            const unmutedIcon = document.getElementById('unmutedIcon');
            const btnText = document.getElementById('soundBtnText');

            if (isMuted) {
                mutedIcon.style.display = 'block';
                unmutedIcon.style.display = 'none';
                btnText.textContent = 'Unmute';
            } else {
                mutedIcon.style.display = 'none';
                unmutedIcon.style.display = 'block';
                btnText.textContent = 'Mute';
            }
        }

        // --- Navigation Functions ---

        function switchTab(index) {
            if (index === currentTab) {
                // Scroll current tab to top (grid view)
                const currentTabEl = document.getElementById(`tab-${videosData.tabs[index].id}`);
                const container = currentTabEl.querySelector('.video-container');
                if (container) {
                    container.scrollTo({ top: 0, behavior: 'smooth' });
                }
                return;
            }

            // Pause current video
            if (currentVideoId) {
                pauseVideo(currentVideoId);
                /* Also reset current video to grid? user usually prefers that */
            }

            // Update UI
            document.querySelectorAll('.tab-btn').forEach((btn, i) => {
                btn.classList.toggle('active', i === index);
            });

            // Slide content
            tabsContainer.style.transform = `translateX(-${index * 100}vw)`;

            // Update state
            currentTab = index;

            // Update BG to the grid of new tab (simple logic)
            if (videosData && videosData.tabs[index]) {
                bgLayer.style.backgroundColor = videosData.tabs[index].videos[0].bgColor;
            }

            // Scroll new tab to top
            const newTab = document.getElementById(`tab-${videosData.tabs[index].id}`);
            if (newTab) {
                const container = newTab.querySelector('.video-container');
                if (container) container.scrollTop = 0;
            }
        }

        function goToVideo(index, tabIndex) {
            if (tabIndex !== undefined && tabIndex !== currentTab) {
                switchTab(tabIndex);
                setTimeout(() => scrollToVideo(index, tabIndex), 500); // wait for slide
            } else {
                scrollToVideo(index, currentTab);
            }
        }

        function scrollToVideo(index, tabIdx) {
            const tabData = videosData.tabs[tabIdx];
            if (!tabData) return;

            const tabEl = document.getElementById(`tab-${tabData.id}`);
            const sections = tabEl.querySelectorAll('.video-section, .grid-section');
            // index 0 is grid, 1 is first video... 
            // The grid item click passes 1 for first video. 
            // Selector query includes grid section first.
            if (sections[index]) {
                sections[index].scrollIntoView({ behavior: 'smooth' });
            }
        }

        let scrollTimeout;
        function handleScroll(e) {
            // Optional: Debounce or logic to sync things if needed
        }

        // Keyboard Navigation
        document.addEventListener('keydown', (e) => {
            const tabData = videosData.tabs[currentTab];
            const tabEl = document.getElementById(`tab-${tabData.id}`);
            const container = tabEl.querySelector('.video-container');
            const sectionHeight = window.innerHeight;

            let currentScrollIndex = Math.round(container.scrollTop / sectionHeight);
            const totalSections = tabData.videos.length + 1; // +1 for grid

            if (e.key === 'ArrowDown' || e.key === 'ArrowRight') {
                if (currentScrollIndex < totalSections - 1) {
                    currentScrollIndex++;
                    scrollToVideo(currentScrollIndex, currentTab);
                }
            } else if (e.key === 'ArrowUp' || e.key === 'ArrowLeft') {
                if (currentScrollIndex > 0) {
                    currentScrollIndex--;
                    scrollToVideo(currentScrollIndex, currentTab);
                }
            }
        });

        // Initialize
        initApp();

    </script>
</body>

</html>