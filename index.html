<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description"
        content="Vibhore Singhal - Sr. UX Designer Portfolio showcasing design work at Zeta, personal projects, and films.">
    <title>ReelsFolio - Vibhore Singhal</title>

    <!-- Preconnect to external domains -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link rel="preconnect" href="https://pub-a6a75e45309c4da7bb1fb6c3aea78409.r2.dev" crossorigin>
    <link rel="preconnect" href="https://pub-876fdc3996be4fb3810906343b32d993.r2.dev" crossorigin>
    <link rel="preconnect" href="https://pub-145d32622a7e4d2586d93017e4e1221c.r2.dev" crossorigin>

    <!-- Preload critical resources -->
    <link rel="preload" href="videos.json" as="fetch" crossorigin>
    <!-- DNS prefetch for thumbnail domains -->
    <link rel="dns-prefetch" href="https://placehold.co">

    <!-- Favicon -->
    <link rel="icon"
        href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>ðŸ‘‹</text></svg>">

    <!-- Font with display swap for better performance -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap"
        rel="stylesheet">
    <!-- GSAP for animations -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
    <!-- Cloudflare Web Analytics -->
    <script defer src='https://static.cloudflareinsights.com/beacon.min.js'
        data-cf-beacon='{"token": "035e36816b514ce68e174a70da8abcb8"}'></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        body,
        html {
            height: 100%;
            overflow: hidden;
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            /* Prevent text/element selection site-wide */
            user-select: none;
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
        }

        /* Background layer that transitions colors */
        .bg-layer {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            transition: background-color 0.6s ease-in-out;
            z-index: -1;
            will-change: background-color;
            contain: strict;
        }

        /* The scroll container */
        .video-container {
            height: 100vh;
            overflow-y: scroll;
            scroll-snap-type: y mandatory;
            scroll-behavior: smooth;
            scrollbar-width: none;
            -ms-overflow-style: none;
        }

        .video-container::-webkit-scrollbar {
            display: none;
        }

        /* Individual video sections */
        .video-section {
            height: 100vh;
            width: 100vw;
            scroll-snap-align: center;
            scroll-snap-stop: always;
            /* Prevent skipping sections */
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
        }

        /* Hero Landing Section - Profile Header (scrolls with page) */
        .hero-section {
            width: 100vw;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: clamp(30px, 5vh, 50px) 20px clamp(20px, 3vh, 30px);
            position: relative;
            background: linear-gradient(180deg, #2d1b4e 0%, #1a0f2e 100%);
            /* No scroll-snap - this scrolls naturally */
        }

        /* Profile Header */
        .profile-header {
            display: flex;
            align-items: center;
            gap: clamp(16px, 3vw, 32px);
            margin-bottom: clamp(16px, 3vh, 24px);
        }

        .profile-photo {
            width: clamp(80px, 12vw, 120px);
            height: clamp(80px, 12vw, 120px);
            border-radius: 50%;
            object-fit: cover;
            border: 4px solid #d4a855;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
        }

        .profile-info {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .profile-name {
            font-size: clamp(22px, 4vw, 36px);
            font-weight: 700;
            color: white;
            margin: 0;
            line-height: 1.1;
        }

        .profile-title {
            font-size: clamp(12px, 1.5vw, 15px);
            color: rgba(255, 255, 255, 0.7);
            margin: 0 0 12px 0;
        }

        .profile-actions {
            display: flex;
            gap: 12px;
        }

        .profile-btn {
            padding: 10px 24px;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            font-family: inherit;
            cursor: pointer;
            transition: all 0.2s ease;
            text-decoration: none;
        }

        .profile-btn.primary {
            background: #7c3aed;
            color: white;
            border: none;
        }

        .profile-btn.primary:hover {
            background: #6d28d9;
            transform: translateY(-2px);
        }

        .profile-btn.secondary {
            background: transparent;
            color: white;
            border: 2px solid #7c3aed;
        }

        .profile-btn.secondary:hover {
            background: rgba(124, 58, 237, 0.2);
            transform: translateY(-2px);
        }

        /* Stats */
        .profile-stats {
            display: flex;
            gap: clamp(32px, 6vw, 64px);
            margin-top: 16px;
        }

        .stat-item {
            text-align: center;
        }

        .stat-value {
            font-size: clamp(20px, 3vw, 28px);
            font-weight: 700;
            color: white;
            display: block;
        }

        .stat-label {
            font-size: clamp(11px, 1.5vw, 13px);
            color: rgba(255, 255, 255, 0.6);
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        /* Skills/Icons Row */
        .profile-skills {
            display: flex;
            gap: clamp(12px, 2vw, 18px);
            /* Reduced top margin further to move circles up, INCREASED bottom margin MAX for more gap */
            margin: clamp(0px, 0.5vh, 4px) 0 clamp(80px, 12vh, 120px) 0;
        }

        .skill-circle {
            width: clamp(36px, 4.5vw, 48px);
            height: clamp(36px, 4.5vw, 48px);
            border-radius: 50%;
            background: rgba(124, 58, 237, 0.4);
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s ease;
        }

        .skill-circle:hover {
            background: rgba(124, 58, 237, 0.6);
            transform: scale(1.1);
        }

        .skill-circle svg {
            width: 50%;
            height: 50%;
            color: white;
        }

        @media (max-width: 768px) {
            .profile-header {
                flex-direction: column;
                text-align: center;
            }
        }

        .video-content-wrapper {
            position: relative;
            display: flex;
            align-items: center;
            justify-content: center;
            width: 100%;
            height: 100%;
            z-index: 5;
        }

        /* Video frame container - 9:16 aspect ratio (phone-like) */
        .video-frame {
            position: relative;
            /* 
             * Width calculation that maintains 9:16 ratio within viewport:
             * - min 280px on very small screens
             * - max 380px on large screens  
             * - 50vw for horizontal responsiveness
             * - calc(80vh * 9 / 16) ensures height won't exceed 80% of viewport
             */
            width: min(clamp(280px, 50vw, 380px), calc(80vh * 9 / 16));
            aspect-ratio: 9/16;
            /* Responsive border radius */
            border-radius: clamp(16px, 3vw, 24px);
            overflow: hidden;
            /* Responsive shadow */
            box-shadow: 0 clamp(15px, 3vh, 25px) clamp(40px, 8vh, 80px) rgba(0, 0, 0, 0.4);
            opacity: 0.2;
            transform: scale(0.9);
            /* Smooth transition for scroll animations */
            transition: opacity 0.4s ease-out, transform 0.4s ease-out;
        }

        /* Vertical Navigation Arrows - FIXED position right of video frame */
        .video-nav-arrows {
            position: fixed;
            /* Position just to the right of video frame */
            left: calc(50% + min(clamp(280px, 50vw, 380px), calc(80vh * 9 / 16)) / 2 + 24px);
            top: 50%;
            transform: translateY(-50%);
            display: flex;
            flex-direction: column;

            z-index: 1000;
            transition: left 0.3s ease;
        }

        /* Adjust arrow position for landscape videos */
        .video-nav-arrows.landscape {
            left: calc(50% + min(85vw, calc(65vh * 16 / 9)) / 2 + 24px);
        }

        .nav-arrow-btn {
            width: 48px;
            height: 48px;
            border-radius: 50%;
            border: 1.5px solid rgba(255, 255, 255, 0.3);
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s ease;
            opacity: 0.7;
            margin-bottom: 12px;
            overflow: hidden;
        }

        .nav-arrow-btn:hover {
            background: rgba(255, 255, 255, 0.2);
            border-color: rgba(255, 255, 255, 0.5);
            opacity: 1;
            transform: scale(1.05);
        }

        .nav-arrow-btn svg {
            width: 22px;
            height: 22px;
            fill: none;
            stroke: white;
            stroke-width: 2;
            stroke-linecap: round;
            stroke-linejoin: round;
        }

        .nav-arrow-btn:last-child {
            margin-bottom: 0;
        }

        .nav-arrow-btn.hidden {
            opacity: 0;
            pointer-events: none;
            height: 0;
            margin-bottom: 0;
            border-width: 0;
        }

        /* Like Button Styles - starts as circle, expands to pill with count */
        .nav-arrow-btn.like-btn {
            width: 48px;
            height: 48px;
            border-radius: 24px;
            flex-direction: column;
            gap: 0;
            padding: 0;
            overflow: hidden;
            justify-content: center;
            align-items: center;
            position: relative;
            transition: height 0.3s ease, background-color 0.2s ease, border-color 0.2s ease;
        }

        .nav-arrow-btn.like-btn.has-likes {
            height: 72px;
        }

        .nav-arrow-btn.like-btn svg {
            width: 24px;
            height: 24px;
            fill: none;
            stroke: white;
            stroke-width: 1.5;
            flex-shrink: 0;
            /* Ensure icon stays centered */
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            transition: all 0.3s ease;
        }

        /* When expanded (has class expand or via JS height change), move icon up */
        .nav-arrow-btn.like-btn.has-likes svg {
            top: 18px;
            /* Fixed position from top */
            transform: translate(-50%, 0);
        }

        /* Make the entire like button fully opaque when liked, overriding default button opacity */
        .nav-arrow-btn.like-btn.liked {
            opacity: 1;
        }

        .nav-arrow-btn.like-btn.liked svg path {
            clip-path: url(#heartClip);
        }

        .nav-arrow-btn.like-btn.liked svg {
            fill: url(#heartGradient);
            stroke: url(#strokeGradient);
            /* Draws the fill first, then the stroke on top. This makes it an "inside" border. */
            paint-order: fill stroke;
            /* width of 3px is used because the clip-path cuts off the outer 1.5px */
            stroke-width: 3;
        }

        .nav-arrow-btn.like-btn.pulse:not(.has-likes) svg {
            animation: heartPulseCenter 0.5s cubic-bezier(0.34, 1.56, 0.64, 1);
        }

        .nav-arrow-btn.like-btn.pulse.has-likes svg {
            animation: heartPulseTop 0.5s cubic-bezier(0.34, 1.56, 0.64, 1);
        }

        @keyframes heartPulseCenter {
            0% {
                transform: translate(-50%, -50%) scale(1);
            }

            40% {
                transform: translate(-50%, -50%) scale(1.35);
            }

            100% {
                transform: translate(-50%, -50%) scale(1);
            }
        }

        @keyframes heartPulseTop {
            0% {
                transform: translate(-50%, 0) scale(1);
            }

            40% {
                transform: translate(-50%, 0) scale(1.35);
            }

            100% {
                transform: translate(-50%, 0) scale(1);
            }
        }

        .like-count {
            font-size: 12px;
            color: white;
            font-weight: 500;
            text-align: center;
            opacity: 0;
            line-height: 1;
            /* Absolute position to avoid affecting flex alignment of heart */
            position: absolute;
            bottom: 14px;
            left: 0;
            width: 100%;
            transition: opacity 0.2s ease;
        }

        .nav-arrow-btn.like-btn.has-likes .like-count {
            opacity: 1;
        }

        /* Flying Heart Animation */
        .flying-heart {
            position: fixed;
            pointer-events: none;
            z-index: 9999;
            will-change: transform, opacity;
            transform: translate(-50%, -50%);
        }

        /* Burst Particle */
        .like-burst-particle {
            position: fixed;
            pointer-events: none;
            z-index: 9998;
            border-radius: 50%;
            will-change: transform, opacity;
            background: #ff3b3b;
        }

        /* Hide nav arrows on mobile */
        @media (max-width: 768px) {
            .video-nav-arrows {
                display: none;
            }
        }

        /* Landscape modification */
        /* Landscape modification */
        /* Landscape modification */
        .video-section.landscape-mode {
            justify-content: center;
            /* Center horizontally */
        }

        .video-section.landscape-mode .video-frame {
            aspect-ratio: 16/9;
            /* Constrain height to leave vertical space for text below */
            width: min(85vw, calc(65vh * 16 / 9));
            border-radius: 12px;
            margin-right: 0;
            margin-bottom: 5vh;
            /* Push up slightly to give even more room at bottom */
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.5);
        }

        /* Landscape Mode Text Layout - Bottom Left (No overlap) */
        /* Landscape Mode Text Layout - Centered Below */
        .video-section.landscape-mode .content-info-left {
            position: absolute;
            left: 50%;
            transform: translateX(-50%);
            bottom: clamp(70px, 12vh, 100px);
            top: auto;
            width: 90vw;
            max-width: 800px;
            text-align: center;
            text-shadow: none;
        }

        .video-section.landscape-mode .content-desc {
            color: rgba(255, 255, 255, 0.9);
            font-size: clamp(14px, 1.5vw, 16px);
            font-weight: 500;
            font-style: italic;
            margin: 0;
            display: inline-block;
        }

        /* Add quotes via CSS */
        .video-section.landscape-mode .content-desc::before {
            content: "â€œ ";
        }

        .video-section.landscape-mode .content-desc::after {
            content: " â€";
        }

        /* Hide title in landscape mode */
        .video-section.landscape-mode .content-title {
            display: none;
        }

        .video-section.active .video-frame {
            opacity: 1;
            transform: scale(1);
        }

        /* R2/HTML5 video - scale to fill vertical 9:16 frame */
        .video-frame video {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            min-width: 100%;
            min-height: 100%;
            width: auto;
            height: 100%;
            object-fit: cover;
            cursor: pointer;
        }

        /* R2 video play button overlay - matches control bar style */
        .video-frame .play-overlay-btn {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 60px;
            height: 60px;
            background: rgba(255, 255, 255, 0.2);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            z-index: 100;
            opacity: 0;
            pointer-events: none;
            transition: all 0.3s ease;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
            color: white;
        }

        /* Only show button when paused */
        .video-frame .play-overlay-btn.paused {
            opacity: 1;
            pointer-events: auto;
        }

        .video-frame .play-overlay-btn:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: translate(-50%, -50%) scale(1.05);
        }

        .play-overlay-btn svg {
            width: 28px;
            height: 28px;
            margin-left: 3px;
        }

        /* ========== VIDEO SEEKBAR ========== */
        .video-seekbar {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            width: auto;
            height: 18px;
            /* Hit area */
            z-index: 110;
            cursor: pointer;
            display: flex;
            align-items: flex-end;
            padding: 0 0 0 0;
            transition: padding 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .video-seekbar:hover,
        .video-seekbar.dragging {
            padding: 0 16px 16px 16px;
        }

        .video-seekbar-track {
            width: 100%;
            height: 3px;
            background: rgba(255, 255, 255, 0.2);
            position: relative;
            border-radius: 0;
            transition: height 0.25s cubic-bezier(0.4, 0, 0.2, 1),
                border-radius 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .video-seekbar:hover .video-seekbar-track,
        .video-seekbar.dragging .video-seekbar-track {
            height: 5px;
            border-radius: 20px;
        }

        .video-seekbar-fill {
            height: 100%;
            width: 0%;
            background: rgba(255, 255, 255, 0.85);
            position: relative;
            border-radius: 0;
            transition: border-radius 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .video-seekbar:hover .video-seekbar-fill,
        .video-seekbar.dragging .video-seekbar-fill {
            border-radius: 20px 0 0 20px;
        }

        /* Thumb circle - hidden by default, appears on hover/drag */
        .video-seekbar-fill::after {
            content: '';
            position: absolute;
            right: -6px;
            top: 50%;
            transform: translateY(-50%) scale(0);
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: white;
            box-shadow: 0 0 6px rgba(0, 0, 0, 0.3), 0 0 12px rgba(255, 255, 255, 0.15);
            transition: transform 0.2s cubic-bezier(0.34, 1.56, 0.64, 1);
            pointer-events: none;
        }

        .video-seekbar:hover .video-seekbar-fill::after,
        .video-seekbar.dragging .video-seekbar-fill::after {
            transform: translateY(-50%) scale(1);
        }

        /* Buffer / background track subtle styling */
        .video-seekbar-track::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(255, 255, 255, 0.08);
            pointer-events: none;
        }

        /* Hide seekbar on landscape video frames â€” use same bar */
        .video-section.landscape-mode .video-seekbar {
            border-radius: 0 0 12px 12px;
        }

        .video-section.landscape-mode .video-seekbar-track {
            border-radius: 0 0 12px 12px;
        }


        /* Decorative stickers */
        .sticker {
            position: absolute;
            opacity: 0;
            transform: scale(0.5);
            transition: opacity 0.5s ease-in-out 0.1s, transform 0.5s ease-in-out 0.1s;
            pointer-events: none;
        }

        .video-section.active .sticker {
            opacity: 1;
            transform: scale(1);
        }

        /* Heart sticker - responsive positioning */
        .sticker-heart {
            top: 15%;
            right: calc(50% - min(280px, 25vw));
            font-size: clamp(32px, 5vw, 48px);
        }

        /* Star sticker - responsive positioning */
        .sticker-star {
            top: 20%;
            left: calc(50% - min(300px, 27vw));
            width: clamp(50px, 7vw, 80px);
            height: clamp(50px, 7vw, 80px);
        }

        /* Plus sticker - responsive positioning */
        .sticker-plus {
            bottom: 35%;
            left: calc(50% - min(250px, 22vw));
            font-size: clamp(28px, 4vw, 40px);
            color: #f0a0d0;
        }

        /* Sparkle sticker - responsive positioning */
        .sticker-sparkle {
            bottom: 40%;
            right: calc(50% - min(280px, 25vw));
            font-size: clamp(22px, 3.5vw, 32px);
        }

        /* Squiggle sticker - responsive positioning */
        .sticker-squiggle {
            bottom: 15%;
            left: calc(50% - min(280px, 25vw));
            width: clamp(40px, 5vw, 60px);
        }

        /* Info bars on the sides - responsive positioning */
        .info-bar {
            position: absolute;
            display: flex;
            flex-direction: column;
            gap: clamp(8px, 1.5vw, 12px);
            opacity: 0;
            transform: translateX(-20px);
            transition: opacity 0.5s ease-in-out 0.15s, transform 0.5s ease-in-out 0.15s;
        }

        .info-bar.right {
            right: calc(50% - min(420px, 35vw));
            top: 50%;
            transform: translateY(-50%) translateX(20px);
        }

        .video-section.active .info-bar {
            opacity: 1;
            transform: translateX(0);
        }

        .video-section.active .info-bar.right {
            transform: translateY(-50%) translateX(0);
        }

        .info-bar.left {
            left: calc(50% - min(420px, 35vw));
            top: 40%;
        }

        .info-line {
            height: clamp(8px, 1.2vw, 12px);
            background: rgba(255, 255, 255, 0.25);
            border-radius: clamp(4px, 0.6vw, 6px);
        }

        .info-line.short {
            width: clamp(40px, 6vw, 60px);
        }

        .info-line.medium {
            width: clamp(65px, 9vw, 100px);
        }

        .info-line.long {
            width: clamp(90px, 12vw, 140px);
        }

        .info-dot {
            width: clamp(20px, 2.5vw, 28px);
            height: clamp(20px, 2.5vw, 28px);
            background: rgba(255, 255, 255, 0.3);
            border-radius: 50%;
        }

        .info-group {
            display: flex;
            align-items: center;
            gap: clamp(8px, 1.2vw, 12px);
        }

        /* NEW: Left Info Section (Title + Desc) */
        .content-info-left {
            position: absolute;
            left: calc(50% - min(650px, 48vw));
            top: 50%;
            transform: translateY(-50%) translateX(-50px);
            width: clamp(250px, 25vw, 350px);
            opacity: 0;
            transition: all 0.6s ease-out 0.2s;
            text-align: left;
            pointer-events: none;
            /* Let clicks pass through if needed */
            z-index: 10;
        }

        .video-section.active .content-info-left {
            opacity: 1;
            transform: translateY(-50%) translateX(0);
        }

        /* Based on design: Description first, then Title */
        .content-desc {
            color: rgba(255, 255, 255, 0.8);
            font-size: clamp(12px, 1.2vw, 14px);
            line-height: 1.5;
            margin-bottom: clamp(12px, 2vh, 20px);
            font-weight: 400;
        }

        .content-title {
            color: white;
            font-size: clamp(36px, 4.5vw, 56px);
            font-weight: 800;
            letter-spacing: -0.02em;
            line-height: 1.1;
        }

        /* Project Link Button */
        .content-link {
            display: inline-flex;
            align-items: center;
            gap: 10px;
            background: rgba(0, 0, 0, 0.35);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.12);
            padding: 14px 22px;
            border-radius: 14px;
            color: rgba(255, 255, 255, 0.85);
            font-size: clamp(14px, 1.5vw, 16px);
            font-weight: 500;
            text-decoration: none;
            margin-top: clamp(16px, 3vh, 24px);
            transition: all 0.3s ease;
            cursor: pointer;
            pointer-events: auto;
        }

        .content-link:hover {
            background: rgba(0, 0, 0, 0.5);
            border-color: rgba(255, 255, 255, 0.25);
            color: white;
            transform: translateY(-2px);
        }

        .content-link svg {
            width: 18px;
            height: 18px;
            opacity: 0.75;
        }

        .content-link:hover svg {
            opacity: 1;
        }

        /* NEW: Right Info Section (Comments) */
        .content-info-right {
            position: absolute;
            right: calc(50% - min(650px, 48vw));
            top: 40%;
            /* Positioned slightly higher to match design */
            transform: translateY(-50%) translateX(50px);
            display: flex;
            flex-direction: column;
            gap: 20px;
            opacity: 0;
            transition: all 0.6s ease-out 0.4s;
            z-index: 10;
        }

        .video-section.active .content-info-right {
            opacity: 1;
            transform: translateY(-50%) translateX(0);
        }

        .comment-pill {
            background: rgba(255, 255, 255, 0.15);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            padding: 12px 16px;
            border-radius: 20px;
            display: flex;
            align-items: center;
            gap: 12px;
            max-width: 280px;
            color: white;
            font-size: 13px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
            animation: subtleFloat 5s ease-in-out infinite;
        }

        /* Stagger animation for multiple comments */
        .comment-pill:nth-child(2) {
            animation-delay: 1.5s;
            animation-duration: 6s;
        }

        .comment-pill:nth-child(3) {
            animation-delay: 3s;
            animation-duration: 5.5s;
        }

        .comment-pill:nth-child(4) {
            animation-delay: 0.5s;
            animation-duration: 6.5s;
        }

        @keyframes subtleFloat {

            0%,
            100% {
                transform: translateY(0) translateX(0) rotate(0deg);
            }

            25% {
                transform: translateY(-6px) translateX(3px) rotate(0.5deg);
            }

            50% {
                transform: translateY(-3px) translateX(-2px) rotate(-0.3deg);
            }

            75% {
                transform: translateY(-8px) translateX(1px) rotate(0.3deg);
            }
        }

        .comment-icon {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.2);
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
            font-size: 16px;
        }

        @keyframes float-floater {

            0%,
            100% {
                transform: translate(0, 0) rotate(var(--init-rotation, 0deg));
            }

            33% {
                transform: translate(5px, -10px) rotate(calc(var(--init-rotation, 0deg) + 2deg));
            }

            66% {
                transform: translate(-5px, -5px) rotate(calc(var(--init-rotation, 0deg) - 2deg));
            }
        }

        /* Removed 1024px hiding rule to avoid dead zone before 768px mobile mode */

        .toggle-btn {
            display: flex;
            align-items: center;
            background: rgba(255, 255, 255, 0.15);
            padding: clamp(6px, 1vw, 8px) clamp(12px, 1.5vw, 16px);
            border-radius: clamp(18px, 2.5vw, 25px);
            gap: clamp(8px, 1.2vw, 12px);
        }

        .toggle-btn .line {
            width: clamp(35px, 5vw, 50px);
            height: clamp(6px, 0.8vw, 8px);
            background: rgba(255, 255, 255, 0.4);
            border-radius: clamp(3px, 0.4vw, 4px);
        }

        .toggle-btn .circle {
            width: clamp(18px, 2.2vw, 24px);
            height: clamp(18px, 2.2vw, 24px);
            background: rgba(255, 255, 255, 0.5);
            border-radius: 50%;
        }

        /* Control bar container - responsive positioning */
        .control-bar {
            position: fixed;
            bottom: clamp(12px, 3vh, 20px);
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            align-items: center;
            gap: clamp(8px, 2vw, 12px);
            z-index: 1000;
            transition: opacity 0.3s ease, visibility 0.3s ease;
            opacity: 1;
            visibility: visible;
        }

        .control-bar.hidden {
            opacity: 0;
            visibility: hidden;
        }

        /* Unmute button - responsive sizing */
        .unmute-btn {
            background: rgba(255, 255, 255, 0.2);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.3);
            color: white;
            padding: clamp(10px, 2vh, 14px) clamp(18px, 4vw, 28px);
            border-radius: 50px;
            font-size: clamp(12px, 2vw, 15px);
            font-family: inherit;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: clamp(6px, 1.5vw, 10px);
            transition: all 0.3s ease;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.2);
        }

        .unmute-btn:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: scale(1.05);
        }

        .unmute-btn svg {
            width: clamp(16px, 3vw, 20px);
            height: clamp(16px, 3vw, 20px);
        }

        /* Unmute button pulse animation - draws attention until user unmutes */
        .unmute-btn.pulsing {
            animation: unmutePulse 2s ease-in-out infinite;
        }

        @keyframes unmutePulse {

            0%,
            100% {
                box-shadow: 0 4px 20px rgba(0, 0, 0, 0.2);
            }

            50% {
                box-shadow: 0 4px 24px rgba(255, 255, 255, 0.2), 0 0 0 5px rgba(255, 255, 255, 0.08);
            }
        }

        /* Play/Stop button - responsive circular button */
        .play-stop-btn {
            width: clamp(36px, 7vw, 44px);
            height: clamp(36px, 7vw, 44px);
            background: rgba(255, 255, 255, 0.2);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            color: white;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.2);
        }

        .play-stop-btn:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: scale(1.1);
        }

        .play-stop-btn svg {
            width: clamp(20px, 4vw, 24px);
            height: clamp(20px, 4vw, 24px);
        }

        /* Grid button at top - responsive sizing */
        .grid-btn {
            position: fixed;
            top: clamp(12px, 3vh, 20px);
            left: 50%;
            transform: translateX(-50%);
            width: clamp(40px, 8vw, 50px);
            height: clamp(40px, 8vw, 50px);
            background: rgba(255, 255, 255, 0.2);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            color: white;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            transition: all 0.3s ease, opacity 0.3s ease, visibility 0.3s ease;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.2);
            opacity: 1;
            visibility: visible;
        }

        .grid-btn.hidden {
            opacity: 0;
            visibility: hidden;
        }

        .grid-btn:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: translateX(-50%) scale(1.1);
        }

        .grid-btn svg {
            width: clamp(18px, 4vw, 24px);
            height: clamp(18px, 4vw, 24px);
        }

        /* Grid Section - UNIFIED FIXED OVERLAY */
        .grid-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: flex-start;
            padding-top: 160px;
            /* Increased to avoid clash with lowered navbar */
            z-index: 10000;
            background: rgba(15, 7, 26, 0.98);
            backdrop-filter: blur(30px);
            -webkit-backdrop-filter: blur(30px);
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.4s cubic-bezier(0.4, 0, 0.2, 1), visibility 0.4s;
            pointer-events: none;
        }

        .grid-overlay.visible {
            opacity: 1;
            visibility: visible;
            pointer-events: auto;
        }

        .grid-overlay-header {
            display: none;
        }

        .grid-tab-nav {
            display: flex;
            align-items: center;
            gap: 6px;
            background: rgba(255, 255, 255, 0.08);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            padding: 6px;
            border-radius: 50px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .grid-tab-btn {
            padding: 10px 20px;
            background: transparent;
            border: none;
            color: rgba(255, 255, 255, 0.6);
            font-size: 14px;
            font-weight: 500;
            font-family: inherit;
            cursor: pointer;
            border-radius: 50px;
            transition: all 0.3s ease;
            white-space: nowrap;
        }

        .grid-tab-btn:hover {
            color: rgba(255, 255, 255, 0.9);
            background: rgba(255, 255, 255, 0.08);
        }

        .grid-tab-btn.active {
            background: rgba(255, 255, 255, 0.2);
            color: white;
        }

        /* Grid panel for each tab's content */
        /* Force the panels wrapper to stretch full width and center its children */
        #gridPanelsContainer {
            width: 100%;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .grid-panel {
            display: none;
            width: 100%;
            justify-content: center;
        }

        .grid-panel.active {
            display: flex;
        }

        .grid-container {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            align-content: start;
            height: auto;
            max-height: calc(100vh - 200px);
            overflow-y: auto;
            /* Hide scrollbar across browsers */
            scrollbar-width: none;
            -ms-overflow-style: none;
            padding-bottom: 60px;
            gap: 24px;
            padding: 24px;
            max-width: 1200px;
            /* width: fit-content enables margin: 0 auto to center accurately when items don't fill max-width */
            width: fit-content;
            margin: 0 auto;
        }

        .grid-container::-webkit-scrollbar {
            display: none;
        }

        /* Grid item entry animation â€” opacity + translateY only (no scale) to avoid CLS */
        @keyframes gridItemEnter {
            0% {
                opacity: 0;
                transform: translateY(20px);
            }

            100% {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .grid-overlay .grid-item {
            opacity: 0;
            transform: translateY(20px);
            will-change: opacity, transform;
        }

        .grid-overlay.visible .grid-item {
            animation: gridItemEnter 0.4s cubic-bezier(0.25, 0.46, 0.45, 0.94) forwards;
        }

        /* Staggered animation delays for grid items */
        .grid-overlay.visible .grid-item:nth-child(1) {
            animation-delay: 0.05s;
        }

        .grid-overlay.visible .grid-item:nth-child(2) {
            animation-delay: 0.1s;
        }

        .grid-overlay.visible .grid-item:nth-child(3) {
            animation-delay: 0.15s;
        }

        .grid-overlay.visible .grid-item:nth-child(4) {
            animation-delay: 0.2s;
        }

        .grid-overlay.visible .grid-item:nth-child(5) {
            animation-delay: 0.25s;
        }

        .grid-overlay.visible .grid-item:nth-child(6) {
            animation-delay: 0.3s;
        }

        .grid-overlay.visible .grid-item:nth-child(7) {
            animation-delay: 0.35s;
        }

        .grid-overlay.visible .grid-item:nth-child(8) {
            animation-delay: 0.4s;
        }

        .grid-overlay.visible .grid-item:nth-child(9) {
            animation-delay: 0.45s;
        }

        .grid-overlay.visible .grid-item:nth-child(10) {
            animation-delay: 0.5s;
        }

        .grid-overlay.visible .grid-item:nth-child(n+11) {
            animation-delay: 0.55s;
        }

        .grid-item {
            /* Same 9:16 aspect ratio as the video frame */
            aspect-ratio: 9/16;
            /* Height based on available vertical space to fit ~2 rows */
            height: calc((100vh - 240px) / 2.2);
            /* Ensure it doesn't get too wide or too tiny */
            min-height: 200px;
            width: auto;
            border-radius: clamp(8px, 1.5vw, 12px);
            overflow: hidden;
            cursor: pointer;
            background: rgba(255, 255, 255, 0.1);
            border: 2px solid transparent;
            /* Only transition visual properties, not layout-triggering ones */
            transition: border-color 0.3s ease, box-shadow 0.3s ease;
            position: relative;
            /* Isolate internal paints from triggering outer layout shifts */
            contain: layout style paint;
            /* Prevent selection highlight when dragging */
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            user-select: none;
            flex-shrink: 0;
        }

        .grid-item:hover {
            border-color: rgba(255, 255, 255, 0.5);
            box-shadow: 0 4px 16px rgba(0, 0, 0, 0.3);
        }

        .grid-item img {
            /* Explicit dimensions prevent the browser from relying on intrinsic size */
            width: 100%;
            height: 100%;
            object-fit: cover;
            opacity: 0;
            transition: opacity 0.3s ease-in-out;
        }

        .grid-item img.loaded {
            opacity: 1;
        }

        .grid-item .video-number {
            position: absolute;
            bottom: clamp(4px, 1vh, 8px);
            left: clamp(4px, 1vw, 8px);
            background: rgba(0, 0, 0, 0.7);
            color: white;
            padding: clamp(2px, 0.5vh, 4px) clamp(6px, 1vw, 10px);
            border-radius: clamp(10px, 2vw, 16px);
            font-size: clamp(10px, 1.5vw, 12px);
            font-weight: 500;
        }

        /* Tab Navigation - sticky on landing, becomes fixed at top when scrolling */
        .tab-nav {
            position: sticky;
            top: clamp(12px, 3vh, 20px);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 6px;
            z-index: 1001;
            background: rgba(255, 255, 255, 0.08);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            padding: 6px;
            border-radius: 50px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            transition: opacity 0.3s ease, visibility 0.3s ease;
            width: fit-content;
            /* Match spacing to scroll-margin-top positioning in grid view */
            /* scroll-margin-top: 80px, tab top: ~20px, tab height: ~44px = 80-64 = 16px gap */
            margin: 0 auto 16px auto;
        }

        .navbar-wrapper {
            position: fixed;
            top: clamp(12px, 3vh, 20px);
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            align-items: center;
            gap: 12px;
            z-index: 11000;
            pointer-events: none;
            transition: top 0.5s cubic-bezier(0.16, 1, 0.3, 1), opacity 0.3s ease;
        }

        .navbar-wrapper.grid-mode {
            top: 60px;
        }

        .navbar-wrapper.grid-mode .logo-btn {
            opacity: 0 !important;
            visibility: hidden !important;
            transform: scale(0.8) !important;
            pointer-events: none !important;
            /* Keep width/margins to prevent horizontal shift of the tabs */
        }

        .navbar-wrapper>* {
            pointer-events: auto;
        }

        /* Logo Button - Separate circular VS initials button */
        .logo-btn {
            width: clamp(40px, 6vw, 50px);
            height: clamp(40px, 6vw, 50px);
            border-radius: 50%;
            background: rgba(0, 0, 0, 0.3);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-family: inherit;
            font-size: clamp(13px, 2vw, 16px);
            font-weight: 600;
            color: rgba(255, 255, 255, 0.85);
            transition: all 0.3s ease, opacity 0.3s ease, visibility 0.3s ease;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.2);
        }

        .logo-btn:hover {
            background: rgba(255, 255, 255, 0.15);
            transform: scale(1.05);
            color: white;
        }

        .logo-btn.active {
            background: rgba(124, 58, 237, 0.6);
            border-color: rgba(124, 58, 237, 0.8);
            color: white;
        }

        /* Grid Overlay Button - Symmetrical to Logo Button */
        .grid-overlay-btn {
            width: clamp(40px, 6vw, 50px);
            height: clamp(40px, 6vw, 50px);
            border-radius: 50%;
            background: rgba(0, 0, 0, 0.3);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-family: inherit;
            color: rgba(255, 255, 255, 0.85);
            transition: all 0.3s ease;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.2);
            position: relative;
        }

        .grid-overlay-btn:hover {
            background: rgba(255, 255, 255, 0.15);
            transform: scale(1.05);
            color: white;
        }

        .grid-overlay-btn svg {
            position: absolute;
            width: 24px;
            height: 24px;
            transition: all 0.3s ease;
        }

        .grid-overlay-btn .close-icon {
            opacity: 0;
            transform: rotate(-90deg) scale(0);
        }

        .navbar-wrapper.grid-mode .grid-overlay-btn .grid-icon {
            opacity: 0;
            transform: rotate(90deg) scale(0);
        }

        .navbar-wrapper.grid-mode .grid-overlay-btn .close-icon {
            opacity: 1;
            transform: rotate(0) scale(1);
        }

        /* Global tabs - fixed behavior handled by navbar-wrapper */
        .tab-nav.global-tabs {
            margin: 0;
            /* Snappier transition for opacity/visibility only */
            transition: opacity 0.3s ease, visibility 0.3s ease;
        }

        /* Landing position state - navbar moves down to between skills and grid */
        .tab-nav.global-tabs.landing-position {
            /* Position handled by JS for perfect sync with scroll */
            pointer-events: auto;
            /* Placeholder to prevent empty ruleset */
        }

        .navbar-wrapper.hidden {
            opacity: 0;
            visibility: hidden;
            pointer-events: none;
        }

        .tab-btn {
            padding: 10px 20px;
            background: transparent;
            border: none;
            color: rgba(255, 255, 255, 0.6);
            font-size: 14px;
            font-weight: 500;
            font-family: inherit;
            cursor: pointer;
            border-radius: 50px;
            transition: all 0.3s ease;
            white-space: nowrap;
        }

        .tab-btn:hover {
            color: rgba(255, 255, 255, 0.9);
            background: rgba(255, 255, 255, 0.1);
        }

        .tab-btn.active {
            background: rgba(255, 255, 255, 0.2);
            color: white;
        }

        /* Single scroll container - no more tab transforms */
        .tabs-container {
            display: contents;
            /* Acts as a simple wrapper, content flows naturally */
        }

        /* Section markers for each category (invisible, used for scroll anchors) */
        .section-marker {
            height: 0;
            width: 100%;
        }

        /* Hide grid button when tabs are visible */
        .grid-btn {
            display: none;
        }

        @media (max-width: 1024px) {

            .info-bar,
            .sticker {
                display: none;
            }
        }

        @media (max-height: 600px) {
            .grid-container {
                max-height: 80vh;
                overflow-y: auto;
            }
        }

        /* Main scroll container */
        .main-scroll-container {
            height: 100vh;
            width: 100vw;
            overflow: hidden;
        }

        .main-scroll-container::-webkit-scrollbar {
            display: none;
        }

        /* Tabs world container - full page */
        .tabs-world {
            height: 100vh;
            width: 100vw;
            position: relative;
            overflow: hidden;
        }

        /* ========== NEW LANDING SECTION STYLES ========== */

        /* Landing Section - Full screen video-like view */
        .landing-section {
            height: 100vh;
            width: 100vw;
            scroll-snap-align: center;
            scroll-snap-stop: always;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
            overflow: hidden;
        }

        /* Landing Profile Info - Left Side */
        .landing-profile-info {
            position: absolute;
            left: clamp(40px, 8vw, 120px);
            bottom: clamp(80px, 15vh, 150px);
            max-width: clamp(280px, 25vw, 400px);
            z-index: 10;
            text-align: left;
        }

        .landing-bio {
            color: rgba(255, 255, 255, 0.75);
            font-size: clamp(13px, 1.3vw, 16px);
            line-height: 1.5;
            margin-bottom: clamp(12px, 2vh, 20px);
            font-weight: 400;
        }

        .landing-name {
            color: white;
            font-size: clamp(32px, 4vw, 52px);
            font-weight: 800;
            letter-spacing: -0.02em;
            line-height: 1.1;
            margin: 0 0 clamp(12px, 2vh, 20px) 0;
        }

        .landing-locations {
            display: flex;
            gap: 12px;
            flex-wrap: wrap;
        }

        .location-tag {
            display: flex;
            align-items: center;
            gap: 6px;
            background: rgba(255, 255, 255, 0.12);
            backdrop-filter: blur(8px);
            -webkit-backdrop-filter: blur(8px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            padding: 8px 14px;
            border-radius: 20px;
            color: rgba(255, 255, 255, 0.9);
            font-size: clamp(12px, 1.2vw, 14px);
            font-weight: 500;
        }

        .location-tag svg {
            width: 14px;
            height: 14px;
            opacity: 0.8;
        }

        /* Landing Video Frame - Center */
        .landing-video-frame {
            position: relative;
            width: min(clamp(280px, 50vw, 380px), calc(80vh * 9 / 16));
            aspect-ratio: 9/16;
            border-radius: clamp(16px, 3vw, 24px);
            overflow: hidden;
            box-shadow: 0 clamp(15px, 3vh, 25px) clamp(40px, 8vh, 80px) rgba(0, 0, 0, 0.5);
            z-index: 5;
            /* Skeleton placeholder background */
            background: linear-gradient(110deg,
                    rgba(255, 255, 255, 0.1) 0%,
                    rgba(255, 255, 255, 0.2) 50%,
                    rgba(255, 255, 255, 0.1) 100%);
            background-size: 200% 100%;
            animation: shimmer 1.5s infinite;
        }

        .landing-video-frame.loaded {
            animation: none;
            background: none;
        }

        .landing-video-frame video,
        .landing-video-frame img {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            object-fit: cover;
        }



        /* Landing video frame play overlay - same as video-frame */
        .landing-video-frame {
            cursor: pointer;
        }

        .landing-video-frame .play-overlay-btn {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 60px;
            height: 60px;
            background: rgba(255, 255, 255, 0.2);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            z-index: 100;
            opacity: 1;
            pointer-events: auto;
            transition: all 0.3s ease;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
            color: white;
        }

        /* Hide button when playing */
        .landing-video-frame .play-overlay-btn.playing {
            opacity: 0;
            pointer-events: none;
        }

        .landing-video-frame .play-overlay-btn:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: translate(-50%, -50%) scale(1.05);
        }

        /* Floating Items */
        .floating-item {
            position: absolute;
            cursor: pointer;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
            transition: box-shadow 0.3s ease;
            z-index: 8;
            /* Initially hidden until image loads */
            opacity: 0;
            transform: scale(0);
            /* Prevent browser selection when dragging */
            user-select: none;
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
        }

        /* Pop animation when image is loaded */
        .floating-item.loaded {
            opacity: 1;
            transform: scale(1) rotate(var(--init-rotation, 0deg));
            animation: popIn 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards, float-floater 8s ease-in-out 0.5s infinite;
        }

        @keyframes popIn {
            0% {
                opacity: 0;
                transform: scale(0);
            }

            100% {
                opacity: 1;
                transform: scale(1) rotate(var(--init-rotation, 0deg));
            }
        }

        .floating-item:hover {
            transform: scale(1.08) rotate(var(--init-rotation, 0deg)) !important;
            box-shadow: 0 12px 48px rgba(0, 0, 0, 0.4);
            z-index: 15;
            animation-play-state: paused;
        }

        .floating-item.size-small {
            width: clamp(80px, 10vw, 120px);
            height: clamp(80px, 10vw, 120px);
        }

        .floating-item.size-medium {
            width: clamp(100px, 12vw, 150px);
            height: clamp(100px, 12vw, 150px);
        }

        .floating-item.size-large {
            width: clamp(120px, 14vw, 180px);
            height: clamp(120px, 14vw, 180px);
        }

        .floating-item img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        @keyframes shimmer {
            0% {
                background-position: 200% 0;
            }

            100% {
                background-position: -200% 0;
            }
        }

        /* Grid item skeleton placeholder */
        .grid-item::before {
            content: '';
            position: absolute;
            inset: 0;
            background: linear-gradient(110deg,
                    rgba(255, 255, 255, 0.05) 0%,
                    rgba(255, 255, 255, 0.1) 50%,
                    rgba(255, 255, 255, 0.05) 100%);
            background-size: 200% 100%;
            animation: shimmer 1.5s infinite;
            border-radius: inherit;
            z-index: 0;
        }

        .grid-item.loaded::before {
            display: none;
        }

        /* Landing Decorative Stickers */
        .landing-sticker {
            position: absolute;
            pointer-events: none;
            z-index: 6;
            /* Stickers stay in place, but can have a subtle rotation if desired or none at all */
            animation: none;
        }

        .landing-sticker.heart {
            color: #ff6b9d;
        }

        .landing-sticker.star {
            color: #5b8dd9;
        }

        .landing-sticker.plus {
            color: #d989b5;
        }

        .landing-sticker.sparkle {
            color: #ff8fb1;
        }

        @keyframes float-sticker {

            0%,
            100% {
                transform: rotate(0deg);
            }

            50% {
                transform: rotate(3deg);
            }
        }

        /* Landing Bottom Toggle/Switch Element */
        .landing-toggle {
            position: absolute;
            bottom: clamp(80px, 12vh, 120px);
            right: clamp(40px, 8vw, 120px);
            display: flex;
            align-items: center;
            gap: 12px;
            background: rgba(0, 0, 0, 0.3);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            padding: 10px 16px;
            border-radius: 30px;
            z-index: 10;
        }

        .landing-toggle .toggle-line {
            width: 60px;
            height: 8px;
            background: rgba(255, 255, 255, 0.3);
            border-radius: 4px;
        }

        .landing-toggle .toggle-circle {
            width: 24px;
            height: 24px;
            background: rgba(255, 255, 255, 0.4);
            border-radius: 50%;
        }

        /* Scroll Indicator */
        .landing-scroll-indicator {
            position: absolute;
            bottom: clamp(20px, 4vh, 40px);
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 8px;
            color: rgba(255, 255, 255, 0.6);
            font-size: 12px;
            animation: bounce 2s ease-in-out infinite;
            cursor: pointer;
            z-index: 10;
        }

        .landing-scroll-indicator svg {
            width: 24px;
            height: 24px;
        }

        @keyframes bounce {

            0%,
            100% {
                transform: translateX(-50%) translateY(0);
            }

            50% {
                transform: translateX(-50%) translateY(8px);
            }
        }

        /* ========== FLOATING ITEM MODAL STYLES ========== */

        .floating-modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            background: rgba(0, 0, 0, 0.7);
            backdrop-filter: blur(8px);
            -webkit-backdrop-filter: blur(8px);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 12000;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s ease, visibility 0.3s ease;
        }

        .floating-modal-overlay.active {
            opacity: 1;
            visibility: visible;
        }

        .floating-modal {
            background: white;
            border-radius: 24px;
            display: flex;
            max-width: 90vw;
            max-height: 85vh;
            overflow: hidden;
            box-shadow: 0 25px 80px rgba(0, 0, 0, 0.4);
            transform: scale(0.9) translateY(20px);
            transition: transform 0.3s ease;
        }

        .floating-modal-overlay.active .floating-modal {
            transform: scale(1) translateY(0);
        }

        .floating-modal-image {
            flex: 0 0 auto;
            max-width: 55%;
            max-height: 85vh;
            display: flex;
            align-items: center;
            justify-content: center;
            background: #f5f5f5;
        }

        .floating-modal-image img {
            max-width: 100%;
            max-height: 85vh;
            object-fit: contain;
            border-radius: 16px 0 0 16px;
        }

        .floating-modal-content {
            flex: 1;
            padding: clamp(30px, 5vw, 50px);
            display: flex;
            flex-direction: column;
            justify-content: center;
            min-width: 280px;
            max-width: 400px;
        }

        .floating-modal-title {
            color: #1a1a1a;
            font-size: clamp(24px, 3vw, 36px);
            font-weight: 700;
            margin: 0 0 16px 0;
            line-height: 1.2;
        }

        .floating-modal-description {
            color: #666;
            font-size: clamp(14px, 1.5vw, 16px);
            line-height: 1.6;
            margin: 0;
        }

        .floating-modal-close {
            position: absolute;
            top: 20px;
            right: 20px;
            width: 40px;
            height: 40px;
            background: rgba(255, 255, 255, 0.9);
            border: none;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.2s ease;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        }

        .floating-modal-close:hover {
            background: white;
            transform: scale(1.1);
        }

        .floating-modal-close svg {
            width: 20px;
            height: 20px;
            color: #333;
        }

        /* Mobile responsive for modal */
        @media (max-width: 768px) {
            .floating-modal {
                flex-direction: column;
                max-width: 95vw;
            }

            .floating-modal-image {
                max-width: 100%;
                max-height: 50vh;
            }

            .floating-modal-image img {
                border-radius: 24px 24px 0 0;
            }

            .floating-modal-content {
                min-width: unset;
                max-width: unset;
            }

            .landing-toggle {
                display: none;
            }

            .floating-item {
                display: none;
            }
        }

        @media (max-width: 1024px) {

            .video-container,
            .landing-section,
            .main-scroll-container,
            .tabs-world {
                height: 100vh !important;
                height: 100dvh !important;
            }

            .video-content-wrapper {
                width: 100vw;
                height: 100vh;
                height: 100dvh;
                overflow: hidden;
            }

            /* --- Video frame: edge-to-edge, no radius --- */
            .video-frame {
                width: 100vw !important;
                height: 100vh !important;
                height: 100dvh !important;
                aspect-ratio: unset !important;
                border-radius: 0 !important;
                box-shadow: none !important;
                opacity: 1 !important;
                transform: none !important;
                transition: none !important;
                z-index: 1 !important;
            }

            .video-section {
                height: 100vh !important;
                height: 100dvh !important;
                overflow: hidden;
            }

            .video-frame video {
                width: 100%;
                height: 100%;
                object-fit: cover;
            }

            /* --- Content overlay: bottom-left INSIDE wrapper --- */
            .content-info-left {
                position: absolute !important;
                left: 16px !important;
                bottom: 80px !important;
                top: auto !important;
                right: 80px !important;
                transform: none !important;
                width: auto !important;
                max-width: calc(100vw - 110px) !important;
                z-index: 200 !important;
                opacity: 0 !important;
                visibility: hidden !important;
                text-shadow: 0 1px 6px rgba(0, 0, 0, 0.8) !important;
                pointer-events: auto !important;
                transition: opacity 0.3s ease !important;
            }

            .video-section.active .content-info-left {
                opacity: 1 !important;
                visibility: visible !important;
                transform: none !important;
            }

            /* --- Action buttons positioning (Vertical Center Right) --- */
            .video-nav-arrows {
                display: flex !important;
                position: fixed !important;
                left: auto !important;
                right: 12px !important;
                top: 50% !important;
                bottom: auto !important;
                transform: translateY(-50%) !important;
                flex-direction: column;
                gap: 16px;
                z-index: 9005 !important;
            }

            .content-title {
                font-size: 20px !important;
                font-weight: 700;
                line-height: 1.2;
                margin-bottom: 4px;
            }

            .content-desc {
                font-size: 13px !important;
                line-height: 1.4;
                margin-bottom: 8px;
                /* Limit to 2 lines to avoid covering too much video */
                display: -webkit-box;
                -webkit-line-clamp: 2;
                line-clamp: 2;
                -webkit-box-orient: vertical;
                overflow: hidden;
            }

            .content-link {
                margin-top: 8px !important;
                font-size: 12px !important;
                padding: 6px 12px !important;
            }

            /* --- Hide desktop-only decorative elements --- */
            .content-info-right,
            .info-bar,
            .sticker,
            .landing-sticker {
                display: none !important;
            }

            /* --- Bottom gradient scrim for text readability --- */
            .video-frame::after {
                content: '';
                position: absolute;
                bottom: 0;
                left: 0;
                right: 0;
                height: 50%;
                background: linear-gradient(to top, rgba(0, 0, 0, 0.6) 0%, transparent 100%);
                pointer-events: none;
                z-index: 50;
            }

            .nav-arrow-btn {
                width: 44px;
                height: 44px;
                background: rgba(255, 255, 255, 0.1);
                border: 1.5px solid rgba(255, 255, 255, 0.3);
                backdrop-filter: blur(4px);
                -webkit-backdrop-filter: blur(4px);
                margin-bottom: 0;
                opacity: 0.9;
            }



            /* --- Control bar repositioned for mobile --- */
            .control-bar {
                display: none !important;
            }

            /* --- Navbar adjustments --- */
            .navbar-wrapper {
                top: 10px !important;
            }

            .tab-btn {
                padding: 8px 14px;
                font-size: 12px;
            }

            .logo-btn {
                width: 36px !important;
                height: 36px !important;
                font-size: 12px !important;
            }

            .grid-overlay-btn {
                width: 36px !important;
                height: 36px !important;
            }

            .grid-overlay-btn svg {
                width: 20px;
                height: 20px;
            }

            /* --- Landing section: edge-to-edge too --- */
            .landing-video-frame {
                width: 100vw !important;
                height: 100vh !important;
                height: 100dvh !important;
                aspect-ratio: unset !important;
                border-radius: 0 !important;
                box-shadow: none !important;
            }

            .landing-video-frame::after {
                content: '';
                position: absolute;
                bottom: 0;
                left: 0;
                right: 0;
                height: 50%;
                background: linear-gradient(to top, rgba(0, 0, 0, 0.6) 0%, transparent 100%);
                pointer-events: none;
                z-index: 4;
            }

            .landing-profile-info {
                left: 16px;
                right: 16px;
                bottom: 80px;
                max-width: none;
                z-index: 10;
                text-shadow: 0 1px 4px rgba(0, 0, 0, 0.6);
            }

            .landing-name {
                font-size: 28px !important;
            }

            .landing-bio {
                font-size: 13px !important;
            }

            /* --- Landscape video mobile override (Films tab) --- */
            .video-section.landscape-mode .video-frame video {
                aspect-ratio: 16/9 !important;
                object-fit: contain !important;
                background: transparent !important;
            }

            .video-section.landscape-mode .content-info-left {
                position: absolute !important;
                left: 16px !important;
                bottom: 80px !important;
                top: auto !important;
                transform: none !important;
                width: auto !important;
                max-width: calc(100vw - 110px) !important;
                text-align: left !important;
                z-index: 200 !important;
                opacity: 0 !important;
                visibility: hidden !important;
            }

            .video-section.active.landscape-mode .content-info-left {
                opacity: 1 !important;
                visibility: visible !important;
            }

            .video-section.landscape-mode .content-desc {
                font-style: normal !important;
            }

            .video-section.landscape-mode .content-desc::before,
            .video-section.landscape-mode .content-desc::after {
                content: none !important;
            }

            .video-section.landscape-mode .content-title {
                display: block !important;
                font-size: 20px !important;
            }

            /* --- Seekbar sits above the gradient --- */
            .video-seekbar {
                z-index: 210;
            }

            /* --- Grid overlay adjustments for mobile --- */
            .grid-overlay {
                padding-top: 100px;
            }

            .grid-item {
                height: calc((100vh - 200px) / 2.5) !important;
                height: calc((100dvh - 200px) / 2.5) !important;
                min-height: 140px !important;
            }

            /* --- Grid overlay adjustments for mobile --- */
            .grid-overlay {
                padding-top: 100px;
                z-index: 10000;
            }
        }

        /* Hide floating items on smaller screens */
        @media (max-width: 1200px) {
            .floating-item.size-small {
                width: clamp(60px, 8vw, 90px);
                height: clamp(60px, 8vw, 90px);
            }

            .floating-item.size-medium {
                width: clamp(80px, 10vw, 120px);
                height: clamp(80px, 10vw, 120px);
            }
        }
    </style>
</head>

<body>
    <!-- Background that transitions with each video -->
    <div class="bg-layer" id="bgLayer"></div>

    <!-- Main Container -->
    <div class="main-scroll-container" id="mainScroll">
        <!-- Tabs World (Contains horizontal tabs + their vertical video scrollers) -->
        <div class="tabs-world" id="tabsWorld">
            <!-- Global Navigation Wrapper -->
            <div class="navbar-wrapper" id="navbarWrapper">
                <!-- Home Logo Button -->
                <button class="logo-btn active" id="logoBtn" onclick="goToLanding()" title="Go to Home">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"
                        style="width: 20px; height: 20px;">
                        <path
                            d="M11.47 3.84a.75.75 0 011.06 0l8.69 8.69a.75.75 0 101.06-1.06l-8.689-8.69a2.25 2.25 0 00-3.182 0l-8.69 8.69a.75.75 0 001.061 1.06l8.69-8.69z" />
                        <path
                            d="M12 5.432l8.159 8.159c.03.03.06.058.091.086v6.198c0 1.035-.84 1.875-1.875 1.875H15a.75.75 0 01-.75-.75v-4.5a.75.75 0 00-.75-.75h-3a.75.75 0 00-.75.75V21a.75.75 0 01-.75.75H5.625a1.875 1.875 0 01-1.875-1.875v-6.198a2.29 2.29 0 00.091-.086L12 5.43z" />
                    </svg>
                </button>

                <!-- Global Fixed Tabs -->
                <nav class="tab-nav global-tabs" id="globalTabs"></nav>

                <!-- Grid Overlay Button -->
                <button class="grid-overlay-btn" id="gridOverlayBtn" onclick="toggleCurrentGrid()" title="View Grid">
                    <svg class="grid-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
                        <path
                            d="M5 5a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H7a2 2 0 01-2-2V5zM5 15a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H7a2 2 0 01-2-2v-2zM15 5a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2V5zM15 15a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2v-2z" />
                    </svg>
                    <svg class="close-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none"
                        stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">
                        <line x1="18" y1="6" x2="6" y2="18"></line>
                        <line x1="6" y1="6" x2="18" y2="18"></line>
                    </svg>
                </button>
            </div>

            <!-- Horizontal Tabs Container -->
            <div class="tabs-container" id="tabsContainer"></div>
        </div>
    </div>

    <!-- Unified Grid Overlay -->
    <div class="grid-overlay" id="gridOverlay" onclick="handleGridOverlayClick(event)">
        <div class="grid-overlay-header">
            <nav class="grid-tab-nav" id="gridTabNav"></nav>
        </div>
        <div id="gridPanelsContainer"></div>
    </div>

    <!-- Floating Item Modal -->
    <div class="floating-modal-overlay" id="floatingModal">
        <button class="floating-modal-close" onclick="closeFloatingModal()">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
                <path fill-rule="evenodd"
                    d="M5.47 5.47a.75.75 0 011.06 0L12 10.94l5.47-5.47a.75.75 0 111.06 1.06L13.06 12l5.47 5.47a.75.75 0 11-1.06 1.06L12 13.06l-5.47 5.47a.75.75 0 01-1.06-1.06L10.94 12 5.47 6.53a.75.75 0 010-1.06z"
                    clip-rule="evenodd" />
            </svg>
        </button>
        <div class="floating-modal">
            <div class="floating-modal-image">
                <img src="" alt="" id="floatingModalImage">
            </div>
            <div class="floating-modal-content">
                <h2 class="floating-modal-title" id="floatingModalTitle"></h2>
                <p class="floating-modal-description" id="floatingModalDescription"></p>
            </div>
        </div>
    </div>

    <!-- Grid Button at Top (hidden, replaced by tabs) -->
    <button class="grid-btn hidden" id="gridBtn" onclick="goToVideo(0)">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
            <path fill-rule="evenodd"
                d="M3 6a3 3 0 013-3h2.25a3 3 0 013 3v2.25a3 3 0 01-3 3H6a3 3 0 01-3-3V6zm9.75 0a3 3 0 013-3H21a3 3 0 013 3v2.25a3 3 0 01-3 3h-2.25a3 3 0 01-3-3V6zM3 15.75a3 3 0 013-3h2.25a3 3 0 013 3v2.25a3 3 0 01-3 3H6a3 3 0 01-3-3v-2.25zm9.75 0a3 3 0 013-3H21a3 3 0 013 3v2.25a3 3 0 01-3 3h-2.25a3 3 0 01-3-3v-2.25z"
                clip-rule="evenodd" />
        </svg>
    </button>

    <!-- Control Bar -->
    <div class="control-bar">
        <!-- Play/Stop Button -->
        <button class="play-stop-btn" id="playStopBtn" onclick="togglePlayStop()">
            <svg id="pauseIcon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
                <path fill-rule="evenodd"
                    d="M6.75 5.25a.75.75 0 01.75-.75H9a.75.75 0 01.75.75v13.5a.75.75 0 01-.75.75H7.5a.75.75 0 01-.75-.75V5.25zm7.5 0A.75.75 0 0115 4.5h1.5a.75.75 0 01.75.75v13.5a.75.75 0 01-.75.75H15a.75.75 0 01-.75-.75V5.25z"
                    clip-rule="evenodd" />
            </svg>
            <svg id="playIcon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"
                style="display: none;">
                <path fill-rule="evenodd"
                    d="M4.5 5.653c0-1.426 1.529-2.33 2.779-1.643l11.54 6.348c1.295.712 1.295 2.573 0 3.285L7.28 19.991c-1.25.687-2.779-.217-2.779-1.643V5.653z"
                    clip-rule="evenodd" />
            </svg>
        </button>

        <!-- Sound Toggle Button -->
        <button class="unmute-btn" id="soundBtn" onclick="toggleSound()">
            <svg id="mutedIcon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
                <path
                    d="M13.5 4.06c0-1.336-1.616-2.005-2.56-1.06l-4.5 4.5H4.508c-1.141 0-2.318 0-2.402.933H2.03c-.01 0-.01.015-.01.033v6.088c0 .018 0 .033.01.033h.076c.084.933 1.261.933 2.402.933h1.932l4.5 4.5c.945.945 2.56.276 2.56-1.06V4.06zM17.78 9.22a.75.75 0 10-1.06 1.06L18.44 12l-1.72 1.72a.75.75 0 101.06 1.06l1.72-1.72 1.72 1.72a.75.75 0 101.06-1.06L20.56 12l1.72-1.72a.75.75 0 10-1.06-1.06l-1.72 1.72-1.72-1.72z" />
            </svg>
            <svg id="unmutedIcon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"
                style="display: none;">
                <path
                    d="M13.5 4.06c0-1.336-1.616-2.005-2.56-1.06l-4.5 4.5H4.508c-1.141 0-2.318 0-2.402.933H2.03c-.01 0-.01.015-.01.033v6.088c0 .018 0 .033.01.033h.076c.084.933 1.261.933 2.402.933h1.932l4.5 4.5c.945.945 2.56.276 2.56-1.06V4.06zM17.72 7.72a.75.75 0 111.06 1.06 3.5 3.5 0 010 6.44.75.75 0 11-1.06-1.06 2 2 0 000-4.38.75.75 0 000-1.06z" />
            </svg>
            <span id="soundBtnText">Unmute</span>
        </button>

    </div>
    <!-- Fixed Navigation Arrows with Like Button -->
    <div class="video-nav-arrows" id="fixedNavArrows">
        <button class="nav-arrow-btn like-btn" id="likeBtn" onclick="toggleLike()" aria-label="Like this video">
            <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" id="likeIcon">
                <defs>
                    <linearGradient id="heartGradient" x1="0%" y1="0%" x2="0%" y2="100%">
                        <stop offset="0%" stop-color="#F2282B" />
                        <stop offset="100%" stop-color="#FF2C9D" />
                    </linearGradient>
                    <linearGradient id="strokeGradient" x1="0%" y1="0%" x2="0%" y2="100%">
                        <stop offset="0%" stop-color="rgba(255, 255, 255, 0.6)" />
                        <stop offset="100%" stop-color="rgba(255, 255, 255, 0)" />
                    </linearGradient>
                    <clipPath id="heartClip">
                        <path
                            d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z" />
                    </clipPath>
                </defs>
                <path
                    d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z" />
            </svg>
            <span class="like-count" id="likeCount"></span>
        </button>
        <button class="nav-arrow-btn hidden" id="navArrowUp" onclick="navigate(-1)" aria-label="Previous section">
            <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                <path d="M12 19V5M5 12l7-7 7 7" />
            </svg>
        </button>
        <button class="nav-arrow-btn" id="navArrowDown" onclick="navigate(1)" aria-label="Next section">
            <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                <path d="M12 5v14M19 12l-7 7-7-7" />
            </svg>
        </button>
    </div>

    <script>
        // State
        let videosData = null;
        let isMuted = true;
        let userManuallyMuted = false; // True when user explicitly clicked mute button
        let isWarping = false; // Flag to prevent BG updates during warp
        let isPlaying = true;
        let observer = null;
        let currentVideoId = null;
        let videosReady = {};
        let isScrolling = false;
        let userPaused = {}; // Track which videos were paused by the user
        let totalSectionsCount = 0; // Total sections for nav arrow visibility
        let playVideoDebounceTimer = null; // Debounce video playback during scroll


        // DOM Elements
        const bgLayer = document.getElementById('bgLayer');
        const tabsContainer = document.getElementById('tabsContainer');
        const globalTabs = document.getElementById('globalTabs');
        const gridBtn = document.getElementById('gridBtn');
        const controlBar = document.querySelector('.control-bar');

        // Safety: Clear warping flag on user interaction to ensure UI updates resume
        window.addEventListener('wheel', () => { if (isWarping) isWarping = false; }, { passive: true });
        window.addEventListener('touchstart', () => { if (isWarping) isWarping = false; }, { passive: true });
        window.addEventListener('keydown', () => { if (isWarping) isWarping = false; }, { passive: true });

        // Initialize
        async function initApp() {
            try {
                const response = await fetch('videos.json');
                videosData = await response.json();

                // Dynamically preload critical landing resources
                const landing = videosData.landingSection;
                if (landing) {
                    // Preload landing video thumbnail for instant display
                    if (landing.profileVideoThumbnail) {
                        const imgPreload = document.createElement('link');
                        imgPreload.rel = 'preload';
                        imgPreload.as = 'image';
                        imgPreload.href = landing.profileVideoThumbnail;
                        document.head.appendChild(imgPreload);
                    }
                    // Preload landing video for faster playback
                    if (landing.profileVideo) {
                        const videoPreload = document.createElement('link');
                        videoPreload.rel = 'preload';
                        videoPreload.as = 'video';
                        videoPreload.href = landing.profileVideo;
                        document.head.appendChild(videoPreload);
                    }
                }

                renderApp();
                initLikeButton(); // Initialize like button state
                initSoundHint(); // Show 'Tap for sound' hint on first visit
            } catch (error) {
                console.error('Failed to load videos:', error);
            }
        }

        // Helper function to get comment icon SVG by type
        function getCommentIcon(type) {
            const iconStyle = 'width: 18px; height: 18px;';
            const icons = {
                heart: `<svg viewBox="0 0 24 24" fill="currentColor" style="${iconStyle}"><path d="M11.645 20.91l-.007-.003-.022-.012a15.247 15.247 0 01-.383-.218 25.18 25.18 0 01-4.244-3.17C4.688 15.36 2.25 12.174 2.25 8.25 2.25 5.322 4.714 3 7.688 3A5.5 5.5 0 0112 5.052 5.5 5.5 0 0116.313 3c2.973 0 5.437 2.322 5.437 5.25 0 3.925-2.438 7.111-4.739 9.256a25.175 25.175 0 01-4.244 3.17 15.247 15.247 0 01-.383.219l-.022.012-.007.004-.003.001a.752.752 0 01-.704 0l-.003-.001z" /></svg>`,
                fire: `<svg viewBox="0 0 24 24" fill="currentColor" style="${iconStyle}"><path fill-rule="evenodd" d="M12.963 2.286a.75.75 0 00-1.071-.136 9.742 9.742 0 00-3.539 6.177 7.547 7.547 0 01-1.705-1.715.75.75 0 00-1.152-.082A9 9 0 1015.68 4.534a7.46 7.46 0 01-2.717-2.248zM15.75 14.25a3.75 3.75 0 11-7.5 0 3.75 3.75 0 017.5 0z" clip-rule="evenodd" /></svg>`,
                sparkle: `<svg viewBox="0 0 24 24" fill="currentColor" style="${iconStyle}"><path fill-rule="evenodd" d="M9 4.5a.75.75 0 01.721.544l.813 2.846a3.75 3.75 0 002.576 2.576l2.846.813a.75.75 0 010 1.442l-2.846.813a3.75 3.75 0 00-2.576 2.576l-.813 2.846a.75.75 0 01-1.442 0l-.813-2.846a3.75 3.75 0 00-2.576-2.576l-2.846-.813a.75.75 0 010-1.442l2.846-.813A3.75 3.75 0 007.466 7.89l.813-2.846A.75.75 0 019 4.5zM18 1.5a.75.75 0 01.728.568l.258 1.036c.236.94.97 1.674 1.91 1.91l1.036.258a.75.75 0 010 1.456l-1.036.258c-.94.236-1.674.97-1.91 1.91l-.258 1.036a.75.75 0 01-1.456 0l-.258-1.036a2.625 2.625 0 00-1.91-1.91l-1.036-.258a.75.75 0 010-1.456l1.036-.258a2.625 2.625 0 001.91-1.91l.258-1.036A.75.75 0 0118 1.5zM16.5 15a.75.75 0 01.712.513l.394 1.183c.15.447.5.799.948.948l1.183.395a.75.75 0 010 1.422l-1.183.395c-.447.15-.799.5-.948.948l-.395 1.183a.75.75 0 01-1.422 0l-.395-1.183a1.5 1.5 0 00-.948-.948l-1.183-.395a.75.75 0 010-1.422l1.183-.395c.447-.15.799-.5.948-.948l.395-1.183A.75.75 0 0116.5 15z" clip-rule="evenodd" /></svg>`,
                star: `<svg viewBox="0 0 24 24" fill="currentColor" style="${iconStyle}"><path fill-rule="evenodd" d="M10.788 3.21c.448-1.077 1.976-1.077 2.424 0l2.082 5.007 5.404.433c1.164.093 1.636 1.545.749 2.305l-4.117 3.527 1.257 5.273c.271 1.136-.964 2.033-1.96 1.425L12 18.354 7.373 21.18c-.996.608-2.231-.29-1.96-1.425l1.257-5.273-4.117-3.527c-.887-.76-.415-2.212.749-2.305l5.404-.433 2.082-5.006z" clip-rule="evenodd" /></svg>`,
                lightning: `<svg viewBox="0 0 24 24" fill="currentColor" style="${iconStyle}"><path fill-rule="evenodd" d="M14.615 1.595a.75.75 0 01.359.852L12.982 9.75h7.268a.75.75 0 01.548 1.262l-10.5 11.25a.75.75 0 01-1.272-.71l1.992-7.302H3.75a.75.75 0 01-.548-1.262l10.5-11.25a.75.75 0 01.913-.143z" clip-rule="evenodd" /></svg>`,
                check: `<svg viewBox="0 0 24 24" fill="currentColor" style="${iconStyle}"><path fill-rule="evenodd" d="M2.25 12c0-5.385 4.365-9.75 9.75-9.75s9.75 4.365 9.75 9.75-4.365 9.75-9.75 9.75S2.25 17.385 2.25 12zm13.36-1.814a.75.75 0 10-1.22-.872l-3.236 4.53L9.53 12.22a.75.75 0 00-1.06 1.06l2.25 2.25a.75.75 0 001.14-.094l3.75-5.25z" clip-rule="evenodd" /></svg>`,
                eye: `<svg viewBox="0 0 24 24" fill="currentColor" style="${iconStyle}"><path d="M12 15a3 3 0 100-6 3 3 0 000 6z" /><path fill-rule="evenodd" d="M1.323 11.447C2.811 6.976 7.028 3.75 12.001 3.75c4.97 0 9.185 3.223 10.675 7.69.12.362.12.752 0 1.113-1.487 4.471-5.705 7.697-10.677 7.697-4.97 0-9.186-3.223-10.675-7.69a1.762 1.762 0 010-1.113zM17.25 12a5.25 5.25 0 11-10.5 0 5.25 5.25 0 0110.5 0z" clip-rule="evenodd" /></svg>`,
                award: `<svg viewBox="0 0 24 24" fill="currentColor" style="${iconStyle}"><path fill-rule="evenodd" d="M5.166 2.621v.858c-1.035.148-2.059.33-3.071.543a.75.75 0 00-.584.859 6.753 6.753 0 006.138 5.6 6.73 6.73 0 002.743 1.346A6.707 6.707 0 019.279 15H8.54c-1.036 0-1.875.84-1.875 1.875V19.5h-.75a.75.75 0 000 1.5h2.625c.621 0 1.125-.504 1.125-1.125v-2.625a.375.375 0 01.375-.375h4.92a.375.375 0 01.375.375v2.625c0 .621.504 1.125 1.125 1.125H18a.75.75 0 000-1.5h-.75v-2.625c0-1.036-.84-1.875-1.875-1.875h-.739a6.706 6.706 0 01-1.112-3.173 6.73 6.73 0 002.743-1.347 6.753 6.753 0 006.139-5.6.75.75 0 00-.585-.858 47.077 47.077 0 00-3.07-.543V2.62a.75.75 0 00-.658-.744 49.22 49.22 0 00-6.093-.377c-2.063 0-4.096.128-6.093.377a.75.75 0 00-.657.744zm0 2.629c0 1.196.312 2.32.857 3.294A5.266 5.266 0 013.16 5.337a45.6 45.6 0 012.006-.343v.256zm13.5 0v-.256c.674.1 1.343.214 2.006.343a5.265 5.265 0 01-2.863 3.207 6.72 6.72 0 00.857-3.294z" clip-rule="evenodd" /></svg>`,
                code: `<svg viewBox="0 0 24 24" fill="currentColor" style="${iconStyle}"><path fill-rule="evenodd" d="M14.447 3.027a.75.75 0 01.527.92l-4.5 16.5a.75.75 0 01-1.448-.394l4.5-16.5a.75.75 0 01.921-.526zM16.72 6.22a.75.75 0 011.06 0l5.25 5.25a.75.75 0 010 1.06l-5.25 5.25a.75.75 0 11-1.06-1.06L21.44 12l-4.72-4.72a.75.75 0 010-1.06zm-9.44 0a.75.75 0 010 1.06L2.56 12l4.72 4.72a.75.75 0 11-1.06 1.06L.97 12.53a.75.75 0 010-1.06l5.25-5.25a.75.75 0 011.06 0z" clip-rule="evenodd" /></svg>`,
                camera: `<svg viewBox="0 0 24 24" fill="currentColor" style="${iconStyle}"><path d="M12 9a3.75 3.75 0 100 7.5A3.75 3.75 0 0012 9z" /><path fill-rule="evenodd" d="M9.344 3.071a49.52 49.52 0 015.312 0c.967.052 1.83.585 2.332 1.39l.821 1.317c.24.383.645.643 1.11.71.386.054.77.113 1.152.177 1.432.239 2.429 1.493 2.429 2.909V18a3 3 0 01-3 3h-15a3 3 0 01-3-3V9.574c0-1.416.997-2.67 2.429-2.909.382-.064.766-.123 1.151-.178a1.56 1.56 0 001.11-.71l.822-1.315a2.942 2.942 0 012.332-1.39zM6.75 12.75a5.25 5.25 0 1110.5 0 5.25 5.25 0 01-10.5 0zm12-2.25a.75.75 0 01.75-.75h.008a.75.75 0 01.75.75v.008a.75.75 0 01-.75.75H19.5a.75.75 0 01-.75-.75V10.5z" clip-rule="evenodd" /></svg>`
            };
            return icons[type] || '';
        }

        // Render the entire app structure - SINGLE PAGE SCROLL
        function renderApp() {
            if (!videosData || !videosData.tabs) return;

            const landing = videosData.landingSection || {};
            const floatingItems = landing.floatingItems || [];

            // 1. Generate Tabs Navigation HTML - these are now scroll anchors or grid switchers
            const tabButtonsHTML = videosData.tabs.map((tab, index) =>
                `<button class="tab-btn" data-tab-id="${tab.id}" onclick="handleTabClick('${tab.id}')">${tab.label}</button>`
            ).join('');

            // Populate Global Fixed Tabs
            if (globalTabs) globalTabs.innerHTML = tabButtonsHTML;

            // Helper function to generate floating items HTML
            function generateFloatingItemsHTML(items) {
                return items.map(item => {
                    const posStyle = [];
                    if (item.position.top) posStyle.push(`top: ${item.position.top}`);
                    if (item.position.bottom) posStyle.push(`bottom: ${item.position.bottom}`);
                    if (item.position.left) posStyle.push(`left: ${item.position.left}`);
                    if (item.position.right) posStyle.push(`right: ${item.position.right}`);

                    const rotation = item.rotation || '0deg';
                    const inlineStyle = `${posStyle.join('; ')}; --init-rotation: ${rotation}; transform: rotate(${rotation});`;

                    return `
                        <div class="floating-item size-${item.size}" 
                             style="${inlineStyle}"
                             onclick="openFloatingModal('${item.id}')"
                             data-item-id="${item.id}">
                            <img src="${item.thumbnail}" alt="${item.title}" draggable="false" loading="lazy"
                                 onload="this.classList.add('loaded'); this.parentElement.classList.add('loaded');">
                        </div>
                    `;
                }).join('');
            }

            // Generate location tags HTML
            function generateLocationTagsHTML(locations) {
                if (!locations || !locations.length) return '';
                return locations.map(loc => {
                    const icon = loc.icon === 'location'
                        ? '<svg viewBox="0 0 24 24" fill="currentColor"><path fill-rule="evenodd" d="M11.54 22.351l.07.04.028.016a.76.76 0 00.723 0l.028-.015.071-.041a16.975 16.975 0 001.144-.742 19.58 19.58 0 002.683-2.282c1.944-1.99 3.963-4.98 3.963-8.827a8.25 8.25 0 00-16.5 0c0 3.846 2.02 6.837 3.963 8.827a19.58 19.58 0 002.682 2.282 16.975 16.975 0 001.145.742zM12 13.5a3 3 0 100-6 3 3 0 000 6z" clip-rule="evenodd" /></svg>'
                        : '<svg viewBox="0 0 24 24" fill="currentColor"><path d="M11.47 3.84a.75.75 0 011.06 0l8.69 8.69a.75.75 0 101.06-1.06l-8.689-8.69a2.25 2.25 0 00-3.182 0l-8.69 8.69a.75.75 0 001.061 1.06l8.69-8.69z" /><path d="M12 5.432l8.159 8.159c.03.03.06.058.091.086v6.198c0 1.035-.84 1.875-1.875 1.875H15a.75.75 0 01-.75-.75v-4.5a.75.75 0 00-.75-.75h-3a.75.75 0 00-.75.75V21a.75.75 0 01-.75.75H5.625a1.875 1.875 0 01-1.875-1.875v-6.198a2.29 2.29 0 00.091-.086L12 5.43z" /></svg>';
                    return `<span class="location-tag">${icon} ${loc.text}</span>`;
                }).join('');
            }

            // 2. Render SINGLE continuous scroll container with ALL content
            // Structure: Landing -> Zeta videos -> Personal videos -> Life videos -> Films videos
            let allSectionsHTML = `
                <!-- LANDING SECTION -->
                <div class="landing-section active" id="section-landing" data-video-id="landing" data-bg-color="${landing.bgColor || '#2d1b4e'}">
                    <div class="landing-profile-info">
                        <p class="landing-bio">${landing.bio || ''}</p>
                        <h1 class="landing-name">${landing.name || 'Vibhore Singhal'}</h1>
                        <div class="landing-locations">
                            ${generateLocationTagsHTML(landing.locations)}
                        </div>
                    </div>
                    <div class="landing-video-frame" onclick="toggleVideo('landing-video')">
                        <video id="landing-video" src="${landing.profileVideo || ''}" poster="${landing.profileVideoThumbnail || ''}" muted playsinline preload="auto" onended="scrollToNextVideo(this)"></video>
                        <div class="play-overlay-btn" id="btn-landing-video">
                            <svg viewBox="0 0 24 24" fill="currentColor"><path fill-rule="evenodd" d="M4.5 5.653c0-1.426 1.529-2.33 2.779-1.643l11.54 6.348c1.295.712 1.295 2.573 0 3.285L7.28 19.991c-1.25.687-2.779-.217-2.779-1.643V5.653z" clip-rule="evenodd" /></svg>
                        </div>
                        <div class="video-seekbar" data-for="landing-video">
                            <div class="video-seekbar-track">
                                <div class="video-seekbar-fill" id="seekbar-landing-video"></div>
                            </div>
                        </div>
                    </div>
                    ${generateFloatingItemsHTML(floatingItems)}
                    <div class="landing-sticker star" style="top: 5%; left: -2%; width: clamp(120px, 18vw, 200px); transform: rotate(-10deg);">
                        <img src="assets/star.svg" alt="star" style="width: 100%; height: 100%;">
                    </div>
                    <div class="landing-sticker heart" style="top: 10%; right: 26%; width: clamp(80px, 10vw, 130px); transform: rotate(15deg);">
                        <img src="assets/heart.svg" alt="heart" style="width: 100%; height: 100%;">
                    </div>
                    <div class="landing-sticker plus" style="bottom: 5%; left: 28%; width: clamp(80px, 12vw, 150px); transform: rotate(-5deg); z-index: 12;">
                        <img src="assets/plus.svg" alt="plus" style="width: 100%; height: 100%;">
                    </div>
                    <div class="landing-sticker star2" style="bottom: 25%; right: 2%; width: clamp(40px, 5vw, 70px); transform: rotate(10deg);">
                        <img src="assets/star2.svg" alt="star2" style="width: 100%; height: 100%;">
                    </div>
                    <div class="landing-sticker wine" style="bottom: -5%; left: -2%; width: clamp(60px, 8vw, 100px); transform: rotate(30deg);">
                        <img src="assets/wine.svg" alt="wine" style="width: 100%; height: 100%;">
                    </div>
                </div>
            `;

            // Calculate total sections for arrow visibility
            let totalSections = 1; // Start with 1 for landing
            videosData.tabs.forEach(tab => totalSections += tab.videos.length);
            totalSectionsCount = totalSections; // Store globally for arrow updates
            let sectionCounter = 1; // Start after landing (landing is index 0)

            // Add all category videos in order
            videosData.tabs.forEach((tab, tabIndex) => {
                tab.videos.forEach((video, videoIndex) => {
                    const isFirstVideo = tabIndex === 0 && videoIndex === 0;
                    const isFirstOfCategory = videoIndex === 0;
                    const preloadStrategy = isFirstVideo ? 'metadata' : 'none';
                    const currentSectionIndex = sectionCounter;

                    allSectionsHTML += `
                        <div class="video-section video-section-r2 ${video.isLandscape ? 'landscape-mode' : ''}" 
                             ${isFirstOfCategory ? `id="section-${tab.id}"` : ''}
                             data-video-id="${video.id}" 
                             data-bg-color="${video.bgColor}" 
                             data-category="${tab.id}"
                             data-section-index="${currentSectionIndex}"
                             data-video-src="${video.src}">
                            
                            <div class="video-content-wrapper">
                                <div class="content-info-left">
                                    ${video.description ? `<p class="content-desc">${video.description}</p>` : ''}
                                    ${video.title ? `<h2 class="content-title">${video.title}</h2>` : ''}
                                    ${video.link ? `<a class="content-link" href="${video.link.url}" target="_blank" rel="noopener noreferrer"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path fill-rule="evenodd" d="M19.902 4.098a3.75 3.75 0 00-5.304 0l-4.5 4.5a3.75 3.75 0 001.035 6.037.75.75 0 01-.646 1.353 5.25 5.25 0 01-1.449-8.45l4.5-4.5a5.25 5.25 0 117.424 7.424l-1.757 1.757a.75.75 0 11-1.06-1.06l1.757-1.757a3.75 3.75 0 000-5.304zm-7.389 4.267a.75.75 0 011-.353 5.25 5.25 0 011.449 8.45l-4.5 4.5a5.25 5.25 0 11-7.424-7.424l1.757-1.757a.75.75 0 111.06 1.06l-1.757 1.757a3.75 3.75 0 105.304 5.304l4.5-4.5a3.75 3.75 0 00-1.035-6.037.75.75 0 01-.354-1z" clip-rule="evenodd" /></svg>${video.link.text}</a>` : ''}
                                </div>
                                
                                <div class="video-frame" onclick="toggleVideo('${video.id}')">
                                    <video id="${video.id}" ${isFirstVideo ? `src="${video.src}"` : ''} data-src="${video.src}" muted playsinline preload="${preloadStrategy}" onended="scrollToNextVideo(this)"></video>
                                    <div class="play-overlay-btn" id="btn-${video.id}"><svg viewBox="0 0 24 24" fill="currentColor"><path fill-rule="evenodd" d="M4.5 5.653c0-1.426 1.529-2.33 2.779-1.643l11.54 6.348c1.295.712 1.295 2.573 0 3.285L7.28 19.991c-1.25.687-2.779-.217-2.779-1.643V5.653z" clip-rule="evenodd" /></svg></div>
                                    <div class="video-seekbar" data-for="${video.id}">
                                        <div class="video-seekbar-track">
                                            <div class="video-seekbar-fill" id="seekbar-${video.id}"></div>
                                        </div>
                                    </div>
                                </div>

                                <div class="content-info-right">
                                    ${video.comments ? video.comments.map(comment => `
                                        <div class="comment-pill">
                                            <div class="comment-icon" style="background: ${comment.type === 'avatar' ? (comment.avatarColor || '#3498db') : 'rgba(255,255,255,0.2)'};">
                                                ${getCommentIcon(comment.type)}
                                            </div>
                                            <span>${comment.text}</span>
                                        </div>
                                    `).join('') : ''}
                                </div>
                            </div>
                        </div>
                    `;
                    sectionCounter++;
                });
            });

            // Put all content in the single scroll container
            tabsContainer.innerHTML = `<div class="video-container" id="mainScrollContainer">${allSectionsHTML}</div>`;

            // Initialize background with landing color
            bgLayer.style.backgroundColor = landing.bgColor || '#2d1b4e';

            // Initialize Observer for single container
            initObserver();

            // Add scroll listener to the single container
            const mainContainer = document.getElementById('mainScrollContainer');
            if (mainContainer) {
                mainContainer.addEventListener('scroll', throttle(handleScroll, 100));
            }

            // Initialize Draggable items
            initDraggable();

            // Mark landing video frame as loaded when video is ready
            const landingVideo = document.getElementById('landing-video');
            const landingFrame = document.querySelector('.landing-video-frame');
            if (landingVideo && landingFrame) {
                landingVideo.addEventListener('loadeddata', () => {
                    landingFrame.classList.add('loaded');
                });
                // Also check if already loaded (cached)
                if (landingVideo.readyState >= 2) {
                    landingFrame.classList.add('loaded');
                }
                // Attach seekbar updater for landing video
                landingVideo.addEventListener('timeupdate', () => {
                    const fill = document.getElementById('seekbar-landing-video');
                    if (fill && landingVideo.duration) {
                        const pct = (landingVideo.currentTime / landingVideo.duration) * 100;
                        fill.style.width = pct + '%';
                    }
                });
            }
        }

        // Throttling function to limit execution of scroll/resize handlers
        function throttle(func, limit) {
            let inThrottle;
            return function () {
                const args = arguments;
                const context = this;
                if (!inThrottle) {
                    func.apply(context, args);
                    inThrottle = true;
                    setTimeout(() => inThrottle = false, limit);
                }
            }
        }

        // Optimized scroll handler
        function handleScroll(e) {
            updateNavArrows();
        }

        // Update fixed navigation arrows based on current scroll position
        function updateNavArrows() {
            const container = document.getElementById('mainScrollContainer');
            const upArrow = document.getElementById('navArrowUp');
            const downArrow = document.getElementById('navArrowDown');

            if (!container || !upArrow || !downArrow) return;

            const sectionHeight = window.innerHeight;
            const currentIndex = Math.round(container.scrollTop / sectionHeight);

            // Hide up arrow on first section (index 0)
            if (currentIndex === 0) {
                upArrow.classList.add('hidden');
            } else {
                upArrow.classList.remove('hidden');
            }

            // Hide down arrow on last section
            if (currentIndex >= totalSectionsCount - 1) {
                downArrow.classList.add('hidden');
            } else {
                downArrow.classList.remove('hidden');
            }
        }

        // Intersection Observer - for single continuous scroll page
        function initObserver() {
            observer = new IntersectionObserver((entries) => {
                entries.forEach(entry => {
                    if (entry.isIntersecting) {
                        entry.target.classList.add('active');

                        // Update background color based on the current section
                        // But skip updates if we are in the middle of a "warp" transition
                        const bgColor = entry.target.getAttribute('data-bg-color');
                        if (bgColor && !isWarping) bgLayer.style.backgroundColor = bgColor;

                        // Update arrow positioning for landscape/portrait
                        const navArrows = document.getElementById('fixedNavArrows');
                        if (navArrows) {
                            if (entry.target.classList.contains('landscape-mode')) {
                                navArrows.classList.add('landscape');
                            } else {
                                navArrows.classList.remove('landscape');
                            }
                        }

                        const isLanding = entry.target.classList.contains('landing-section');
                        const isVideo = entry.target.classList.contains('video-section');
                        const logoBtn = document.getElementById('logoBtn');
                        const navbarWrapper = document.getElementById('navbarWrapper');

                        if (navbarWrapper) {
                            navbarWrapper.classList.remove('hidden');
                        }

                        if (isLanding) {
                            if (controlBar) controlBar.classList.remove('hidden');
                            if (logoBtn) logoBtn.classList.add('active');
                            document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
                            if (!isWarping) debouncedPlayVideo('landing-video');
                            if (!isWarping) updateLikeButtonForCurrentVideo('landing', false, true);
                        } else if (isVideo) {
                            if (controlBar) controlBar.classList.remove('hidden');
                            if (logoBtn) logoBtn.classList.remove('active');

                            // Highlight tab based on current video's category
                            const category = entry.target.getAttribute('data-category');
                            document.querySelectorAll('.tab-btn').forEach(btn => {
                                const tabId = btn.getAttribute('data-tab-id');
                                btn.classList.toggle('active', tabId === category);
                            });

                            const videoId = entry.target.getAttribute('data-video-id');
                            if (!isWarping) debouncedPlayVideo(videoId);
                            if (!isWarping) updateLikeButtonForCurrentVideo(videoId, false, true);
                        }
                    } else {
                        entry.target.classList.remove('active');
                        if (entry.target.classList.contains('video-section')) {
                            const videoId = entry.target.getAttribute('data-video-id');
                            pauseVideo(videoId);
                        }
                        if (entry.target.classList.contains('landing-section')) {
                            pauseVideo('landing-video');
                        }
                    }
                });
            }, { threshold: 0.7 });

            // Observe all section types (Grid is now an overlay, not observed)
            document.querySelectorAll('.landing-section, .video-section').forEach(section => {
                observer.observe(section);
            });

            // Lazy loading observer - preloads videos that are about to come into view
            const lazyLoadObserver = new IntersectionObserver((entries) => {
                entries.forEach(entry => {
                    if (entry.isIntersecting) {
                        const section = entry.target;
                        const videoId = section.getAttribute('data-video-id');
                        if (videoId) {
                            lazyLoadVideo(videoId);
                        }
                        // Also preload the next video
                        const nextSection = section.nextElementSibling;
                        if (nextSection && nextSection.classList.contains('video-section')) {
                            const nextVideoId = nextSection.getAttribute('data-video-id');
                            if (nextVideoId) {
                                lazyLoadVideo(nextVideoId);
                            }
                        }
                    }
                });
            }, { rootMargin: '100% 0px 100% 0px', threshold: 0 }); // Preload 1 viewport ahead

            document.querySelectorAll('.video-section').forEach(section => {
                lazyLoadObserver.observe(section);
            });
        }

        // Lazy load video source
        function lazyLoadVideo(videoId) {
            const video = document.getElementById(videoId);
            if (!video) return;

            // If video already has src, skip
            if (video.src && video.src !== window.location.href) return;

            const dataSrc = video.getAttribute('data-src');
            if (dataSrc && !video.src) {
                video.src = dataSrc;
                video.load();
            }
        }

        // --- Video Control Functions ---

        // Debounced play: cancels any pending play and schedules a new one.
        // This prevents audio bleed from intermediate sections during fast scrolling.
        function debouncedPlayVideo(videoId) {
            // Cancel any previous pending play
            clearTimeout(playVideoDebounceTimer);
            // Immediately mute AND pause ALL videos to kill any audio instantly
            document.querySelectorAll('.video-section video, .landing-section video').forEach(v => {
                v.muted = true;
                if (!v.paused) v.pause();
            });
            // Schedule play for the target video after scroll settles
            playVideoDebounceTimer = setTimeout(() => {
                playVideo(videoId);
            }, 150);
        }


        function playVideo(videoId) {
            const video = document.getElementById(videoId);
            if (!video) return;

            // Lazy load video source if not loaded yet
            if (!video.src || video.src === window.location.href) {
                const dataSrc = video.getAttribute('data-src');
                if (dataSrc) {
                    video.src = dataSrc;
                    video.load();
                }
            }

            currentVideoId = videoId;
            isPlaying = true;

            // Update icons
            document.getElementById('pauseIcon').style.display = 'block';
            document.getElementById('playIcon').style.display = 'none';

            video.currentTime = 0;
            video.play().catch(e => console.log('Autoplay blocked:', e));

            video.muted = isMuted;

            // Attach seekbar updater if not already attached
            if (!video._seekbarAttached) {
                video.addEventListener('timeupdate', () => {
                    const fill = document.getElementById('seekbar-' + videoId);
                    if (fill && video.duration) {
                        const pct = (video.currentTime / video.duration) * 100;
                        fill.style.width = pct + '%';
                    }
                });
                video._seekbarAttached = true;
            }

            // Update overlay button
            const btn = document.getElementById('btn-' + videoId);
            if (btn) {
                if (videoId === 'landing-video') {
                    btn.classList.add('playing'); // Hide button when playing
                } else {
                    btn.classList.remove('paused');
                }
            }
        }

        function pauseVideo(videoId) {
            const video = document.getElementById(videoId);
            if (!video) return;

            video.pause();
            // Don't show play button for system-initiated pauses (scrolling away)
            // Only show if it was previously user-paused
        }

        // --- Seekbar: click/drag to seek ---
        function seekVideo(event, videoId) {
            event.stopPropagation();
            const video = document.getElementById(videoId);
            const bar = event.currentTarget.closest('.video-seekbar');
            const track = bar ? bar.querySelector('.video-seekbar-track') : null;
            if (!video || !video.duration || !track) return;

            const rect = track.getBoundingClientRect();
            const x = (event.clientX || event.touches?.[0]?.clientX || 0) - rect.left;
            const pct = Math.max(0, Math.min(1, x / rect.width));
            video.currentTime = pct * video.duration;
        }

        // Unified drag-to-seek for mouse and touch
        (function initSeekbarDrag() {
            let activeBar = null;
            let activeVideo = null;

            function startDrag(e) {
                const bar = e.target.closest('.video-seekbar');
                if (!bar) return;
                e.preventDefault();
                e.stopPropagation();

                const videoId = bar.getAttribute('data-for');
                const video = document.getElementById(videoId);
                if (!video || !video.duration) return;

                activeBar = bar;
                activeVideo = video;
                bar.classList.add('dragging');
                doSeek(e);
            }

            function doSeek(e) {
                if (!activeBar || !activeVideo) return;
                const track = activeBar.querySelector('.video-seekbar-track');
                if (!track) return;

                const rect = track.getBoundingClientRect();
                const clientX = e.clientX ?? e.touches?.[0]?.clientX ?? 0;
                const x = clientX - rect.left;
                const pct = Math.max(0, Math.min(1, x / rect.width));
                activeVideo.currentTime = pct * activeVideo.duration;

                // Immediately update fill for responsiveness
                const fill = activeBar.querySelector('.video-seekbar-fill');
                if (fill) fill.style.width = (pct * 100) + '%';
            }

            function endDrag() {
                if (activeBar) {
                    activeBar.classList.remove('dragging');
                }
                activeBar = null;
                activeVideo = null;
            }

            // Mouse events
            document.addEventListener('mousedown', startDrag);
            document.addEventListener('mousemove', (e) => { if (activeBar) doSeek(e); });
            document.addEventListener('mouseup', endDrag);

            // Touch events
            document.addEventListener('touchstart', startDrag, { passive: false });
            document.addEventListener('touchmove', (e) => { if (activeBar) { e.preventDefault(); doSeek(e); } }, { passive: false });
            document.addEventListener('touchend', endDrag);
            document.addEventListener('touchcancel', endDrag);
        })();

        function scrollToNextVideo(videoEl) {
            const currentSection = videoEl.closest('.video-section') || videoEl.closest('.landing-section');
            if (!currentSection) return;
            const nextSection = currentSection.nextElementSibling;

            if (nextSection && (nextSection.classList.contains('video-section') || nextSection.classList.contains('landing-section'))) {
                nextSection.scrollIntoView({ behavior: 'smooth' });
            } else {
                // Last video - show play button again
                toggleVideo(videoEl.id);
            }
        }

        function toggleVideo(videoId, fromVideoTap = true) {
            const video = document.getElementById(videoId);
            const btn = document.getElementById('btn-' + videoId);
            if (!video) return;

            // If muted (from autoplay policy, not user choice) and video is playing,
            // first tap on the VIDEO unmutes instead of pausing.
            // Once the user has manually muted, this no longer triggers.
            if (fromVideoTap && isMuted && !userManuallyMuted && !video.paused) {
                unmuteAndDismissHint();
                return;
            }

            const isLandingVideo = videoId === 'landing-video';

            if (video.paused) {
                video.play();
                if (btn) {
                    if (isLandingVideo) {
                        btn.classList.add('playing');
                    } else {
                        btn.classList.remove('paused');
                    }
                }
                userPaused[videoId] = false;
                isPlaying = true;
                document.getElementById('pauseIcon').style.display = 'block';
                document.getElementById('playIcon').style.display = 'none';
            } else {
                video.pause();
                if (btn) {
                    if (isLandingVideo) {
                        btn.classList.remove('playing');
                    } else {
                        btn.classList.add('paused');
                    }
                }
                userPaused[videoId] = true;
                isPlaying = false;
                document.getElementById('pauseIcon').style.display = 'none';
                document.getElementById('playIcon').style.display = 'block';
            }
        }

        function togglePlayStop() {
            if (!currentVideoId) return;
            toggleVideo(currentVideoId, false); // false = from control bar, not a video tap
        }

        function toggleSound() {
            isMuted = !isMuted;
            userManuallyMuted = isMuted; // User intentionally chose this state
            updateMuteUI();

            if (currentVideoId) {
                const video = document.getElementById(currentVideoId);
                if (video) video.muted = isMuted;
            }

            // Stop pulsing when user unmutes via the button
            if (!isMuted) stopUnmutePulse();
        }

        // Global unmute helper â€” used by tap-to-unmute, sound button, and volume keys
        function unmuteAndDismissHint() {
            if (!isMuted) return;
            isMuted = false;
            updateMuteUI();
            if (currentVideoId) {
                const video = document.getElementById(currentVideoId);
                if (video) video.muted = false;
            }
            stopUnmutePulse();
        }

        // Stop the pulse animation on the unmute button
        function stopUnmutePulse() {
            const soundBtn = document.getElementById('soundBtn');
            if (soundBtn) soundBtn.classList.remove('pulsing');
        }

        // Start the unmute button pulse on first visit
        function initSoundHint() {
            // Start pulsing the unmute button to draw attention
            setTimeout(() => {
                if (isMuted) {
                    const soundBtn = document.getElementById('soundBtn');
                    if (soundBtn) soundBtn.classList.add('pulsing');
                }
            }, 1500);
        }

        function updateMuteUI() {
            const mutedIcon = document.getElementById('mutedIcon');
            const unmutedIcon = document.getElementById('unmutedIcon');
            const btnText = document.getElementById('soundBtnText');

            if (isMuted) {
                mutedIcon.style.display = 'block';
                unmutedIcon.style.display = 'none';
                btnText.textContent = 'Unmute';
            } else {
                mutedIcon.style.display = 'none';
                unmutedIcon.style.display = 'block';
                btnText.textContent = 'Mute';
            }
        }

        // --- Volume key detection: auto-unmute on volume up/down ---
        document.addEventListener('keydown', (e) => {
            if (e.key === 'AudioVolumeUp' || e.key === 'AudioVolumeDown' ||
                e.key === 'VolumeUp' || e.key === 'VolumeDown') {
                if (isMuted) {
                    unmuteAndDismissHint();
                }
            }
        });

        // --- Like Button Functions ---
        // --- Like Button Functions (Per-Video with Cloudflare Worker) ---

        // IMPORTANT: Replace this with your Cloudflare Worker URL after deployment
        const LIKES_WORKER_URL = 'https://reelsfolio-likes.vibhoresinghal.workers.dev'; // e.g., 'https://reelsfolio-likes.YOUR-SUBDOMAIN.workers.dev'

        let likesCache = {}; // Cache of video likes { videoId: count }
        let pendingLikes = {}; // Pending likes to sync { videoId: count }
        let likeDebounceTimer = null;

        function getCurrentVideoId() {
            // Get the currently visible video's ID
            const container = document.getElementById('mainScrollContainer');
            if (!container) return 'landing';

            const sectionHeight = window.innerHeight;
            const currentIndex = Math.round(container.scrollTop / sectionHeight);
            const sections = container.querySelectorAll('.landing-section, .video-section');

            if (sections[currentIndex]) {
                return sections[currentIndex].getAttribute('data-video-id') ||
                    sections[currentIndex].id ||
                    'landing';
            }
            return 'landing';
        }

        function toggleLike() {
            const likeBtn = document.getElementById('likeBtn');
            const likeCount = document.getElementById('likeCount');
            const videoId = getCurrentVideoId();

            // Mark as liked by this user
            likeBtn.classList.add('liked');

            // Track that this user has liked this video
            const userLikes = JSON.parse(localStorage.getItem('userLikedVideos') || '{}');
            userLikes[videoId] = true;
            localStorage.setItem('userLikedVideos', JSON.stringify(userLikes));

            // Increment count (Medium-style clap - each click adds 1)
            const currentCount = parseInt(likeCount.textContent) || 0;
            const newCount = currentCount + 1;
            likeCount.textContent = newCount;

            // Animate button expansion if this is the first like
            if (currentCount === 0) {
                likeBtn.classList.add('has-likes');
                gsap.to(likeBtn, {
                    height: 72,
                    duration: 0.3,
                    ease: 'power2.out'
                });
                gsap.to(likeCount, {
                    opacity: 1,
                    duration: 0.2,
                    delay: 0.1,
                    ease: 'power2.out'
                });
            }

            // Update cache
            likesCache[videoId] = newCount;

            // Track pending likes to sync
            pendingLikes[videoId] = (pendingLikes[videoId] || 0) + 1;

            // Trigger pulse animation
            likeBtn.classList.remove('pulse');
            void likeBtn.offsetWidth; // Force reflow
            likeBtn.classList.add('pulse');

            // Create flying heart effect
            createFlyingHeart(likeBtn);
            createLikeBurst(likeBtn);

            // Haptic feedback for mobile
            if ('vibrate' in navigator) {
                try { navigator.vibrate(30); } catch (e) { }
            }

            // Debounced save to server (batches rapid clicks)
            clearTimeout(likeDebounceTimer);
            likeDebounceTimer = setTimeout(() => {
                savePendingLikes();
            }, 500);

            // Also save to localStorage as backup
            const localLikes = JSON.parse(localStorage.getItem('videoLikes') || '{}');
            localLikes[videoId] = newCount;
            localStorage.setItem('videoLikes', JSON.stringify(localLikes));
        }

        async function savePendingLikes() {
            if (!LIKES_WORKER_URL) return; // Worker not configured

            const likesToSave = { ...pendingLikes };
            pendingLikes = {};

            for (const [videoId, increment] of Object.entries(likesToSave)) {
                try {
                    await fetch(`${LIKES_WORKER_URL}/likes`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ videoId, increment })
                    });
                } catch (error) {
                    console.warn('Failed to save like:', error);
                    // Re-add to pending on failure
                    pendingLikes[videoId] = (pendingLikes[videoId] || 0) + increment;
                }
            }
        }

        async function loadLikesFromServer() {
            if (!LIKES_WORKER_URL) return null;

            try {
                const response = await fetch(`${LIKES_WORKER_URL}/likes/all`);
                if (response.ok) {
                    return await response.json();
                }
            } catch (error) {
                console.warn('Failed to load likes from server:', error);
            }
            return null;
        }

        function createFlyingHeart(button) {
            const rect = button.getBoundingClientRect();
            const svgIcon = button.querySelector('svg');
            const iconRect = svgIcon ? svgIcon.getBoundingClientRect() : rect;

            const centerX = iconRect.left + iconRect.width / 2;
            const centerY = iconRect.top + iconRect.height / 2;

            const flyingHeart = document.createElement('div');
            flyingHeart.className = 'flying-heart';
            flyingHeart.innerHTML = `<svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" style="width: 100%; height: 100%; fill: url(#heartGradient); stroke: url(#strokeGradient); stroke-width: 3; paint-order: fill stroke; clip-path: url(#heartClip);">
                <path d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"></path>
            </svg>`;

            Object.assign(flyingHeart.style, {
                left: `${centerX}px`,
                top: `${centerY}px`,
                width: '28px',
                height: '28px',
                opacity: '0'
            });

            document.body.appendChild(flyingHeart);

            // GSAP settings for an organic, curved float away
            const xDrift = (Math.random() - 0.5) * 60;
            const yDrift = - (80 + Math.random() * 50);
            const rot = (Math.random() - 0.5) * 45;

            const tl = gsap.timeline({
                onComplete: () => {
                    if (flyingHeart.parentNode) flyingHeart.remove();
                }
            });

            tl.fromTo(flyingHeart,
                { opacity: 0.8, scale: 0.5, x: 0, y: 0, rotation: 0 },
                { opacity: 1, scale: 1.2, x: xDrift * 0.3, y: yDrift * 0.3, rotation: rot * 0.5, duration: 0.3, ease: "back.out(1.5)" }
            ).to(flyingHeart, {
                opacity: 0,
                scale: 0.8,
                x: xDrift,
                y: yDrift,
                rotation: rot,
                duration: 0.7,
                ease: "power2.out"
            });
        }

        function createLikeBurst(button) {
            const svgIcon = button.querySelector('svg');
            const iconRect = svgIcon ? svgIcon.getBoundingClientRect() : button.getBoundingClientRect();

            const centerX = iconRect.left + iconRect.width / 2;
            const centerY = iconRect.top + iconRect.height / 2;

            const particleCount = 6 + Math.floor(Math.random() * 4); // 6 to 9 particles

            for (let i = 0; i < particleCount; i++) {
                const particle = document.createElement('div');
                particle.className = 'like-burst-particle';

                // Playful, vibrant colors matching the premium aesthetic
                const colors = ['#ff3b3b', '#e80b91', '#ffffff', '#ff007f', '#ff7eb3'];
                const color = colors[Math.floor(Math.random() * colors.length)];

                const size = 4 + Math.random() * 6; // 4px to 10px

                Object.assign(particle.style, {
                    left: `${centerX - size / 2}px`,
                    top: `${centerY - size / 2}px`,
                    width: `${size}px`,
                    height: `${size}px`,
                    background: color,
                    opacity: '1'
                });

                document.body.appendChild(particle);

                // calculate burst trajectory in full 360 circle
                const angle = (i / particleCount) * Math.PI * 2 + (Math.random() * 0.5 - 0.25);
                const distance = 25 + Math.random() * 35;

                gsap.to(particle, {
                    x: Math.cos(angle) * distance,
                    y: Math.sin(angle) * distance,
                    opacity: 0,
                    scale: Math.random() * 0.5 + 0.3,
                    duration: 0.4 + Math.random() * 0.3,
                    ease: "power2.out",
                    onComplete: () => {
                        if (particle.parentNode) particle.remove();
                    }
                });
            }

            // Tiny satisfying structural wobble/shake on the actual button element
            // We use fromTo to ensure it always starts the rotation crisp
            gsap.fromTo(button,
                { rotation: (Math.random() > 0.5 ? 1 : -1) * (4 + Math.random() * 4) }, // random slight rotation between 4 and 8 deg
                { rotation: 0, duration: 0.6, ease: "elastic.out(1.2, 0.4)", clearProps: "rotation" }
            );
        }

        function updateLikeButtonVisuals(count, skipAnimation) {
            const likeBtn = document.getElementById('likeBtn');
            const likeCount = document.getElementById('likeCount');
            if (!likeBtn || !likeCount) return;

            // Animate like button based on count
            const hasLikes = count > 0;
            const currentHeight = likeBtn.offsetHeight;
            const targetHeight = hasLikes ? 72 : 48;
            const isAlreadyExpanded = likeBtn.classList.contains('has-likes');

            if (hasLikes) {
                likeCount.textContent = count;
                likeBtn.classList.add('has-likes');

                if (skipAnimation || (isAlreadyExpanded && Math.abs(currentHeight - targetHeight) < 2)) {
                    gsap.set(likeBtn, { height: targetHeight });
                    gsap.set(likeCount, { opacity: 1 });
                } else {
                    gsap.to(likeBtn, { height: targetHeight, duration: 0.3, ease: 'power2.out' });
                    gsap.to(likeCount, { opacity: 1, duration: 0.2, delay: 0.1, ease: 'power2.out' });
                }
            } else {
                likeBtn.classList.remove('has-likes');
                if (skipAnimation || (!isAlreadyExpanded && Math.abs(currentHeight - targetHeight) < 2)) {
                    gsap.set(likeBtn, { height: targetHeight });
                    gsap.set(likeCount, { opacity: 0 });
                    likeCount.textContent = '';
                } else {
                    gsap.to(likeCount, { opacity: 0, duration: 0.15, ease: 'power2.in' });
                    gsap.to(likeBtn, { height: targetHeight, duration: 0.3, delay: 0.05, ease: 'power2.out', onComplete: () => { likeCount.textContent = ''; } });
                }
            }
        }

        async function updateLikeButtonForCurrentVideo(videoIdOverride, skipAnimation = false, forceRender = false) {
            const likeBtn = document.getElementById('likeBtn');
            const videoId = videoIdOverride || getCurrentVideoId();

            if (!likeBtn) return;

            // Check if USER has liked this video (stored locally)
            const userLikes = JSON.parse(localStorage.getItem('userLikedVideos') || '{}');
            if (userLikes[videoId]) {
                likeBtn.classList.add('liked');
            } else {
                likeBtn.classList.remove('liked');
            }

            // Get count from cache first
            let count = likesCache[videoId];

            // If not in cache, try localStorage then fetch from server (NON-BLOCKING)
            if (count === undefined) {
                // Check localStorage first for instant display
                const localLikes = JSON.parse(localStorage.getItem('videoLikes') || '{}');
                count = localLikes[videoId] || 0;

                // Cache immediately so we render
                likesCache[videoId] = count;

                // Background Fetch
                if (LIKES_WORKER_URL) {
                    fetch(`${LIKES_WORKER_URL}/likes?videoId=${encodeURIComponent(videoId)}`)
                        .then(r => r.json())
                        .then(data => {
                            const newCount = Math.max(data.count || 0, count);

                            // If server has more, update cache and visuals
                            if (newCount !== likesCache[videoId]) {
                                likesCache[videoId] = newCount;
                                // Only update visually if the user is still on this video OR if we grabbed lock
                                if (forceRender || getCurrentVideoId() === videoId) {
                                    updateLikeButtonVisuals(newCount, false);
                                }
                            }
                        })
                        .catch(e => console.warn('Failed to fetch likes:', e));
                }
            }

            // Render visuals immediately with whatever data we have
            if (forceRender || getCurrentVideoId() === videoId) {
                updateLikeButtonVisuals(count, skipAnimation);
            }
        }

        async function initLikeButton() {
            const likeBtn = document.getElementById('likeBtn');
            const likeCount = document.getElementById('likeCount');

            if (!likeBtn || !likeCount) return;

            // Try to load from server first
            const serverLikes = await loadLikesFromServer();
            if (serverLikes) {
                likesCache = serverLikes;
                // Merge with localStorage (keep higher counts)
                const localLikes = JSON.parse(localStorage.getItem('videoLikes') || '{}');
                for (const [videoId, count] of Object.entries(localLikes)) {
                    if (!likesCache[videoId] || localLikes[videoId] > likesCache[videoId]) {
                        likesCache[videoId] = count;
                    }
                }
            } else {
                // Fallback to localStorage
                likesCache = JSON.parse(localStorage.getItem('videoLikes') || '{}');
            }

            // Update display for current video
            updateLikeButtonForCurrentVideo(undefined, true);

            // Note: Like button updates are now handled by the IntersectionObserver in initObserver
            // for more reliable section tracking during scroll snap.
        }

        // --- Floating Item Modal Functions ---

        function openFloatingModal(itemId) {
            const landing = videosData.landingSection;
            if (!landing || !landing.floatingItems) return;

            const item = landing.floatingItems.find(i => i.id === itemId);
            if (!item) return;

            const modal = document.getElementById('floatingModal');
            const image = document.getElementById('floatingModalImage');
            const title = document.getElementById('floatingModalTitle');
            const description = document.getElementById('floatingModalDescription');

            image.src = item.src;
            image.alt = item.title;
            title.textContent = item.title;
            description.textContent = item.description;

            modal.classList.add('active');
            document.body.style.overflow = 'hidden';
        }

        function closeFloatingModal() {
            const modal = document.getElementById('floatingModal');
            modal.classList.remove('active');
            document.body.style.overflow = '';
        }

        // Close modal on overlay click
        document.getElementById('floatingModal')?.addEventListener('click', (e) => {
            if (e.target.classList.contains('floating-modal-overlay')) {
                closeFloatingModal();
            }
        });

        // Close modal on Escape key
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape') {
                closeFloatingModal();
                closeGridOverlay();
            }
        });

        // Scroll to first video from landing section
        function scrollToFirstVideo() {
            scrollToCategory('zeta');
        }

        // --- Navigation Functions (Simplified for single-page scroll) ---

        // Handle tab button clicks - switch grid panel if in grid mode, otherwise scroll
        function handleTabClick(categoryId) {
            const navbarWrapper = document.getElementById('navbarWrapper');
            const isGridMode = navbarWrapper && navbarWrapper.classList.contains('grid-mode');

            if (isGridMode) {
                // In grid mode - switch the grid panel
                switchGridTab(categoryId);
            } else {
                // Normal mode - scroll to category
                scrollToCategory(categoryId);
            }

            // Update tab button highlighting
            document.querySelectorAll('.tab-btn').forEach(btn => {
                const tabId = btn.getAttribute('data-tab-id');
                btn.classList.toggle('active', tabId === categoryId);
            });
        }

        // Navigate to the landing/profile section
        function goToLanding() {
            closeGridOverlay();
            const container = document.getElementById('mainScrollContainer');
            if (container) {
                // Reset and start playing the landing video immediately so
                // the user never sees a stale paused frame during the scroll
                const landingVideo = document.getElementById('landing-video');
                if (landingVideo) {
                    landingVideo.currentTime = 0;
                    landingVideo.muted = isMuted;
                    landingVideo.play().catch(() => { });
                    currentVideoId = 'landing-video';
                    isPlaying = true;
                    userPaused['landing-video'] = false;

                    // Hide the play overlay button since video is now playing
                    const btn = document.getElementById('btn-landing-video');
                    if (btn) btn.classList.add('playing');

                    // Update control bar icons
                    document.getElementById('pauseIcon').style.display = 'block';
                    document.getElementById('playIcon').style.display = 'none';
                }

                const landingSection = container.querySelector('.landing-section');
                const targetColor = landingSection ? landingSection.getAttribute('data-bg-color') : null;
                smartScrollTo(0, container, targetColor);

                // Explicitly update like button for landing
                updateLikeButtonForCurrentVideo('landing', false, true);

                // Safety net: if the observer race-condition paused the video
                // during the scroll, resume it without resetting currentTime
                setTimeout(() => {
                    const lv = document.getElementById('landing-video');
                    if (lv && lv.paused) {
                        lv.play().catch(() => { });
                        currentVideoId = 'landing-video';
                        isPlaying = true;
                    }
                }, 1200);
            }
        }

        // Scroll to a category section
        function scrollToCategory(categoryId) {
            const container = document.getElementById('mainScrollContainer');
            if (!container) return;

            const section = document.getElementById(`section-${categoryId}`);
            if (!section) {
                console.warn(`Section not found: section-${categoryId}`);
                return;
            }

            // Find the index of this section among all sections
            const allSections = Array.from(container.querySelectorAll('.landing-section, .video-section'));
            const sectionIndex = allSections.indexOf(section);

            if (sectionIndex >= 0) {
                const targetTop = sectionIndex * window.innerHeight;
                const targetColor = section.getAttribute('data-bg-color');
                smartScrollTo(targetTop, container, targetColor);

                // Update like button for target section immediately
                const videoId = section.getAttribute('data-video-id');
                if (videoId) updateLikeButtonForCurrentVideo(videoId, false, true);
            }
        }

        // Scroll to a specific video by index within the main container
        function scrollToVideoByIndex(index) {
            const container = document.getElementById('mainScrollContainer');
            if (!container) return;

            const sections = container.querySelectorAll('.landing-section, .video-section');
            if (sections[index]) {
                const targetTop = index * window.innerHeight;
                const targetColor = sections[index].getAttribute('data-bg-color');
                smartScrollTo(targetTop, container, targetColor);
            }
        }

        function toggleCurrentGrid() {
            const gridOverlay = document.getElementById('gridOverlay');
            if (gridOverlay.classList.contains('visible')) {
                closeGridOverlay();
            } else {
                openGridOverlay();
            }
        }

        // Track if video was playing before grid opened
        let videoWasPlayingBeforeGrid = false;

        function openGridOverlay(activeCategory = null) {
            const gridOverlay = document.getElementById('gridOverlay');
            const gridPanelsContainer = document.getElementById('gridPanelsContainer');
            const navbarWrapper = document.getElementById('navbarWrapper');

            // Determine which category to show based on current scroll position
            const currentSection = document.querySelector('.video-section.active, .landing-section.active');
            const currentCat = currentSection?.getAttribute('data-category') || 'zeta';
            const effectiveCategory = activeCategory || currentCat;

            // Highlight the correct tab button
            document.querySelectorAll('.tab-btn').forEach(btn => {
                const tabId = btn.getAttribute('data-tab-id');
                btn.classList.toggle('active', tabId === effectiveCategory);
            });

            // Pause current video for performance
            if (currentVideoId) {
                const video = document.getElementById(currentVideoId);
                if (video && !video.paused) {
                    videoWasPlayingBeforeGrid = true;
                    video.pause();
                } else {
                    videoWasPlayingBeforeGrid = false;
                }
            }

            // Generate grid panels for all tabs
            gridPanelsContainer.innerHTML = videosData.tabs.map((tab) => `
                <div class="grid-panel ${tab.id === effectiveCategory ? 'active' : ''}" data-panel-id="${tab.id}">
                    <div class="grid-container">
                        ${tab.videos.map((video, vIndex) => `
                            <div class="grid-item" onclick="goToVideoFromGrid('${tab.id}', ${vIndex})">
                                <img src="${video.thumbnail || 'https://placehold.co/360x640/png?text=Thumbnail'}" 
                                     width="360" height="640"
                                     draggable="false" 
                                     loading="${tab.id === effectiveCategory ? 'eager' : 'lazy'}"
                                     onload="this.classList.add('loaded'); this.parentElement.classList.add('loaded');" />
                                <span class="video-number">${vIndex + 1}</span>
                            </div>
                        `).join('')}
                    </div>
                </div>
            `).join('');

            gridOverlay.classList.add('visible');
            if (navbarWrapper) navbarWrapper.classList.add('grid-mode');
        }

        function switchGridTab(tabId) {
            // Update tab buttons
            document.querySelectorAll('.tab-btn').forEach(btn => {
                const btnTabId = btn.getAttribute('data-tab-id');
                btn.classList.toggle('active', btnTabId === tabId);
            });
            // Update panels
            document.querySelectorAll('.grid-panel').forEach(panel => {
                const panelId = panel.getAttribute('data-panel-id');
                panel.classList.toggle('active', panelId === tabId);
            });
        }

        function closeGridOverlay() {
            const gridOverlay = document.getElementById('gridOverlay');
            const navbarWrapper = document.getElementById('navbarWrapper');

            if (gridOverlay) gridOverlay.classList.remove('visible');
            if (navbarWrapper) navbarWrapper.classList.remove('grid-mode');

            // Resume video if it was playing before
            if (videoWasPlayingBeforeGrid && currentVideoId) {
                const video = document.getElementById(currentVideoId);
                if (video) video.play();
            }
        }

        function handleGridOverlayClick(event) {
            const isClickOnContent = event.target.closest('.grid-item') ||
                event.target.closest('.grid-tab-nav') ||
                event.target.closest('.grid-close-btn');

            if (!isClickOnContent) {
                closeGridOverlay();
            }
        }

        // Smart scroll function - uses 'Stitched Glide' for distant jumps
        // Smart scroll function - uses 'Warp Zoom' for distant jumps
        function smartScrollTo(targetTop, container, targetColor = null) {
            const currentTop = container.scrollTop;
            const distance = Math.abs(targetTop - currentTop);
            const sectionHeight = window.innerHeight;

            // If jumping more than 4 sections away, use Warp Zoom
            if (distance > sectionHeight * 4) {
                const direction = targetTop > currentTop ? 1 : -1;

                // Start Warp Sequence
                isWarping = true;

                // Provide direct background transition
                if (targetColor) {
                    bgLayer.style.backgroundColor = targetColor;
                }

                // 1. Engage Warp: Blur, shrink, and fade to simulate speed/depth
                container.style.transition = 'filter 0.2s ease-in, transform 0.2s ease-in, opacity 0.2s ease-in';
                container.style.filter = 'blur(12px)';
                container.style.transform = 'scale(0.98)';
                container.style.opacity = '0.8';

                setTimeout(() => {
                    // 2. Transport: Disable snapping and leapfrog
                    container.style.scrollSnapType = 'none';
                    container.style.scrollBehavior = 'auto';

                    // Mute and pause ALL videos before the jump
                    document.querySelectorAll('.video-section video, .landing-section video').forEach(v => {
                        v.muted = true;
                        if (!v.paused) v.pause();
                    });

                    // Jump to 2 sections vertically away from target for more scroll motion
                    container.scrollTop = targetTop - (direction * sectionHeight * 2);

                    // Force reflow
                    void container.offsetHeight;

                    // 3. Arrival: GSAP Smooth Scroll for controlled landing (Native-like feel)
                    gsap.to(container, {
                        scrollTop: targetTop,
                        duration: 0.7,
                        ease: "power2.out"
                    });

                    // 4. Disengage: Clear warp effects (synced with scroll)
                    setTimeout(() => {
                        container.style.transition = 'filter 0.7s ease-out, transform 0.8s cubic-bezier(0.25, 1, 0.5, 1), opacity 0.7s ease-out';
                        container.style.filter = 'blur(0px)';
                        container.style.transform = 'scale(1)';
                        container.style.opacity = '1';

                        // Cleanup styles after animation
                        setTimeout(() => {
                            container.style.transition = '';
                            container.style.filter = '';
                            container.style.transform = '';
                            container.style.opacity = '';
                            container.style.scrollSnapType = '';
                            container.style.scrollBehavior = '';

                            // Enable observer updates again
                            isWarping = false;

                            // Play the target video now that warp is done
                            const targetSection = container.querySelector('.landing-section, .video-section');
                            const snappedIndex = Math.round(container.scrollTop / sectionHeight);
                            const allSections = container.querySelectorAll('.landing-section, .video-section');
                            if (allSections[snappedIndex]) {
                                const vid = allSections[snappedIndex].getAttribute('data-video-id');
                                if (vid) playVideo(vid);
                                else if (allSections[snappedIndex].classList.contains('landing-section')) playVideo('landing-video');
                            }
                        }, 800);
                    }, 100);
                }, 200);
            } else {
                // Near jump - use normal smooth scroll
                isWarping = true; // Block observer updates during scroll

                // Manually update BG since observer is blocked
                if (targetColor) bgLayer.style.backgroundColor = targetColor;

                const originalSnapType = container.style.scrollSnapType;
                container.style.scrollSnapType = 'none';
                container.scrollTo({ top: targetTop, behavior: 'smooth' });

                setTimeout(() => {
                    container.style.scrollSnapType = originalSnapType || '';
                    isWarping = false; // Re-enable observer updates

                    // Play the correct video now that scroll settled
                    const snappedIndex = Math.round(container.scrollTop / sectionHeight);
                    const allSections = container.querySelectorAll('.landing-section, .video-section');
                    if (allSections[snappedIndex]) {
                        const vid = allSections[snappedIndex].getAttribute('data-video-id');
                        if (vid) playVideo(vid);
                        else if (allSections[snappedIndex].classList.contains('landing-section')) playVideo('landing-video');
                    }
                }, 800);
            }
        }

        // Navigate to a video from the grid overlay
        function goToVideoFromGrid(categoryId, videoIndex) {
            closeGridOverlay();

            // Immediately silence all videos before scrolling
            document.querySelectorAll('.video-section video, .landing-section video').forEach(v => {
                v.muted = true;
                if (!v.paused) v.pause();
            });

            const container = document.getElementById('mainScrollContainer');
            if (!container) return;

            // Find the target section among all sections
            const allSections = container.querySelectorAll('.landing-section, .video-section');
            const categorySections = container.querySelectorAll(`[data-category="${categoryId}"]`);

            if (!categorySections[videoIndex]) return;

            const targetSection = categorySections[videoIndex];

            // Find the absolute index of this section
            let absoluteIndex = -1;
            allSections.forEach((s, idx) => {
                if (s === targetSection) {
                    absoluteIndex = idx;
                }
            });

            if (absoluteIndex >= 0) {
                const targetTop = absoluteIndex * window.innerHeight;
                const targetColor = targetSection.getAttribute('data-bg-color');
                smartScrollTo(targetTop, container, targetColor);

                // Explicitly update like button
                const videoId = targetSection.getAttribute('data-video-id');
                if (videoId) updateLikeButtonForCurrentVideo(videoId, false, true);
            }
        }

        // Scroll to a specific section in the main container
        function scrollToVideo(index, smooth = true) {
            const container = document.getElementById('mainScrollContainer');
            if (!container) return;

            const sections = container.querySelectorAll('.landing-section, .video-section');
            if (sections[index]) {
                const targetTop = index * window.innerHeight;

                // Temporarily disable scroll-snap for smooth programmatic scrolling
                const originalSnapType = container.style.scrollSnapType;
                container.style.scrollSnapType = 'none';

                container.scrollTo({
                    top: targetTop,
                    behavior: smooth ? 'smooth' : 'auto'
                });

                setTimeout(() => {
                    container.style.scrollSnapType = originalSnapType || '';
                    if (!container.style.scrollSnapType) container.style.removeProperty('scroll-snap-type');
                }, smooth ? 800 : 50);
            }
        }

        // Navigate to next/previous section (for keyboard navigation)
        // Queued navigation - allows updating target mid-transition
        let navigationTargetIndex = null;
        let navigationScrollId = 0; // Track current scroll animation

        function navigate(direction) {
            const container = document.getElementById('mainScrollContainer');
            if (!container) return;

            const sectionHeight = window.innerHeight;
            const sections = container.querySelectorAll('.landing-section, .video-section');
            const totalSections = sections.length;

            // Determine base index: use current target if scrolling, otherwise use current scroll position
            let baseIndex;
            if (isScrolling && navigationTargetIndex !== null) {
                // We're mid-transition - update from current target
                baseIndex = navigationTargetIndex;
            } else {
                // Fresh navigation - calculate from scroll position
                baseIndex = Math.round(container.scrollTop / sectionHeight);
            }

            let newIndex = baseIndex + direction;

            // Clamp to valid range
            if (newIndex < 0) newIndex = 0;
            if (newIndex >= totalSections) newIndex = totalSections - 1;

            // If already at same index, do nothing
            if (newIndex === navigationTargetIndex && isScrolling) return;

            // Update target and start/restart scroll
            navigationTargetIndex = newIndex;
            navigationScrollId++; // Invalidate any previous scroll timeout
            const thisScrollId = navigationScrollId;

            isScrolling = true;
            scrollToVideo(newIndex);

            // Reset scrolling flag after animation completes (only for this scroll)
            setTimeout(() => {
                if (navigationScrollId === thisScrollId) {
                    isScrolling = false;
                    navigationTargetIndex = null;
                }
            }, 800);
        }

        // Block horizontal scroll on trackpad (prevent visual glitches)
        document.addEventListener('wheel', (e) => {
            if (Math.abs(e.deltaX) > Math.abs(e.deltaY) && Math.abs(e.deltaX) > 3) {
                e.preventDefault();
            }
        }, { passive: false });

        // Keyboard Navigation
        document.addEventListener('keydown', (e) => {
            if (e.key === 'ArrowDown' || e.key === 'ArrowRight') {
                navigate(1);
            } else if (e.key === 'ArrowUp' || e.key === 'ArrowLeft') {
                navigate(-1);
            }
        });

        // Touch handling removed - native scroll handles single page navigation

        // --- Draggable Utility ---

        function makeDraggable(el) {
            let pos1 = 0, pos2 = 0, pos3 = 0, pos4 = 0;
            let dragOccurred = false;
            let startX, startY;

            // Use both mouse and touch events
            el.addEventListener('mousedown', dragStart);
            el.addEventListener('touchstart', dragStart, { passive: false });

            // Intercept and cancel the 'click' event if we were dragging
            el.addEventListener('click', (e) => {
                if (dragOccurred) {
                    e.stopImmediatePropagation();
                    e.preventDefault();
                    dragOccurred = false;
                }
            }, true); // Capture phase is key to blocking inline onclick

            function dragStart(e) {
                // Ignore right clicks
                if (e.type === 'mousedown' && e.button !== 0) return;

                const clientX = e.type === 'touchstart' ? e.touches[0].clientX : e.clientX;
                const clientY = e.type === 'touchstart' ? e.touches[0].clientY : e.clientY;

                startX = clientX;
                startY = clientY;
                pos3 = clientX;
                pos4 = clientY;

                // Reset drag flag at start of interaction
                dragOccurred = false;

                // Sync the element's top/left to its current visual position before dragging
                const rect = el.getBoundingClientRect();
                const parentRect = el.parentElement.getBoundingClientRect();

                // Set explicit top/left and clear bottom/right/margins
                el.style.top = (rect.top - parentRect.top) + "px";
                el.style.left = (rect.left - parentRect.left) + "px";
                el.style.bottom = 'auto';
                el.style.right = 'auto';
                el.style.margin = '0';

                // Remove transition and animation during drag for responsiveness
                el.style.transition = 'none';
                el.style.animation = 'none';
                el.style.zIndex = '1000'; // Bring to front

                if (e.type === 'mousedown') {
                    document.addEventListener('mousemove', elementDrag);
                    document.addEventListener('mouseup', dragEnd);
                } else {
                    document.addEventListener('touchmove', elementDrag, { passive: false });
                    document.addEventListener('touchend', dragEnd);
                }
            }

            function elementDrag(e) {
                const clientX = e.type === 'touchmove' ? e.touches[0].clientX : e.clientX;
                const clientY = e.type === 'touchmove' ? e.touches[0].clientY : e.clientY;

                if (e.type === 'touchmove') e.preventDefault(); // Prevent scrolling while dragging

                pos1 = pos3 - clientX;
                pos2 = pos4 - clientY;
                pos3 = clientX;
                pos4 = clientY;

                // Move threshold to distinguish click from drag
                if (!dragOccurred && (Math.abs(clientX - startX) > 5 || Math.abs(clientY - startY) > 5)) {
                    dragOccurred = true;
                }

                el.style.top = (el.offsetTop - pos2) + "px";
                el.style.left = (el.offsetLeft - pos1) + "px";
            }

            function dragEnd() {
                document.removeEventListener('mousemove', elementDrag);
                document.removeEventListener('mouseup', dragEnd);
                document.removeEventListener('touchmove', elementDrag);
                document.removeEventListener('touchend', dragEnd);

                el.style.transition = '';
                // Note: dragOccurred remains true if it was a drag, 
                // until the 'click' event fires and our listener resets it.
            }
        }

        function initDraggable() {
            const draggables = document.querySelectorAll('.floating-item');
            draggables.forEach(el => {
                makeDraggable(el);
                // Change cursor to indicate draggability
                el.style.cursor = 'move';
            });
        }

        // Initialize
        initApp();

    </script>
</body>

</html>